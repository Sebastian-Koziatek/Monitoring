# Bar gauge

Bar gauge to wizualizacja przedstawiająca wartości w formie poziomych lub pionowych pasków wypełnienia. Jest to uproszczona wersja Gauge, bardziej kompaktowa i idealna do wyświetlania wielu metryk jednocześnie w formie listy. Bar gauge łączy zalety Stat (kompaktowość) z wizualną reprezentacją Gauge (pasek postępu).

## Charakterystyka wizualizacji

Wizualizacja Bar gauge składa się z:
- **Etykieta**: Nazwa metryki lub serii
- **Pasek wypełnienia**: Kolorowy pasek pokazujący wartość względem zakresu
- **Wartość numeryczna**: Aktualna wartość z jednostką
- **Progi kolorystyczne**: Segmenty paska w różnych kolorach

Najczęstsze zastosowania:
- Lista serwerów z wykorzystaniem zasobów (CPU, RAM)
- Przegląd wykorzystania dysków na wielu partycjach
- Ranking top N (top użytkownicy, endpoint'y, błędy)
- Porównanie metryk między środowiskami
- Status wielu serwisów jednocześnie
- Monitoring wielu równoległych procesów lub zadań
- Przegląd metryk dla wielu lokalizacji/regionów

## Konfiguracja panelu

### Panel options

Standardowe opcje panelu (identyczne jak w innych wizualizacjach).

### Bar gauge settings

**Orientation**: Orientacja pasków
- **Auto**: Automatyczny dobór orientacji
- **Horizontal**: Paski poziome (domyślnie, najczęściej używane)
- **Vertical**: Paski pionowe

```yaml
# Horizontal: Najlepsze dla list metryk z etykietami po lewej
# - CPU Server 1: ████████░░ 80%
# - CPU Server 2: ██████░░░░ 60%
# - CPU Server 3: ███████████ 95%

# Vertical: Oszczędność miejsca, dobre dla wielu krótkich metryk
```

**Display mode**: Sposób wyświetlania wartości
- **Gradient**: Gładki gradient kolorów w pasku (estetyczne)
- **LCD**: Segmentowany wygląd (retro, LCD display)
- **Basic**: Podstawowy, jednolity kolor paska (najczęściej używane)

**Show unfilled area**: Wyświetlanie niewypełnionego obszaru
- **On**: Pokazuj szary obszar dla niewypełnionej części (domyślnie)
- **Off**: Tylko wypełniony pasek, bez tła

**Min width**: Minimalna szerokość paska (dla horizontal) lub wysokość (dla vertical)
**Max width**: Maksymalna szerokość paska

### Calculation

Określa jaką wartość z serii danych wyświetlać:

**Calculation**:
- **Last (not null)**: Ostatnia niepusta wartość (domyślnie)
- **Last**: Ostatnia wartość
- **Min**: Minimum
- **Max**: Maksimum  
- **Mean**: Średnia
- **Sum**: Suma
- **Count**: Liczba pomiarów

```PromQL
# Przykłady użycia:

# Last (not null) - bieżące wykorzystanie zasobów
100 - (avg by(instance) (rate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100)

# Max - szczytowe wykorzystanie w okresie
max_over_time(node_cpu_percent[1h])

# Mean - średnie wykorzystanie
avg_over_time(node_memory_percent[15m])
```

### Standard options

**Unit**: Jednostka miary
```yaml
# Typowe jednostki dla Bar gauge:
# - percent (0-100): Procenty (CPU, RAM, dysk)
# - bytes: Bajty (wielkość danych)
# - bytes/sec: Przepustowość
# - ms: Milisekundy (czas odpowiedzi)
# - short: Liczby bez jednostki (count)
# - requests/sec: Żądania na sekundę
```

**Min/Max**: Zakres wartości dla paska
- **Min**: Minimalna wartość (domyślnie: 0)
- **Max**: Maksymalna wartość (domyślnie: 100)

```yaml
# Przykłady zakresów:
# CPU/RAM: Min: 0, Max: 100 (procenty)
# Response time: Min: 0, Max: 1000 (ms)
# Disk space: Min: 0, Max: <capacity> (bytes)
```

**Decimals**: Miejsca po przecinku
- **Auto**: Grafana decyduje
- **0**: Liczby całkowite
- **1-2**: Standardowa precyzja

**Display name**: Zmiana nazwy wyświetlanej
```
Przykład: ${__field.labels.instance} - ${__field.labels.job}
```

**Color scheme**:
- **From thresholds (by value)**: Kolory według progów (najczęściej używane)
- **Single color**: Jeden kolor dla wszystkich pasków
- **Classic palette**: Różne kolory dla każdej serii
- **Green-Yellow-Red**: Gradient dla progów

**No value**: Tekst gdy brak danych

### Thresholds

Progi definiują kolorystykę pasków:

**Mode**:
- **Absolute**: Stałe wartości progów
- **Percentage**: Progi procentowe (0-100)

**Steps**: Definicja progów i kolorów
```yaml
# Przykład 1: Wykorzystanie zasobów (0-100%)
# Base (0): Green - niskie wykorzystanie
# 70: Yellow - średnie wykorzystanie
# 85: Orange - wysokie wykorzystanie  
# 95: Red - krytyczne wykorzystanie

# Przykład 2: Response time (ms)
# Base (0): Green - szybko (0-200ms)
# 200: Yellow - akceptowalne (200-500ms)
# 500: Orange - wolno (500-1000ms)
# 1000: Red - bardzo wolno (>1000ms)

# Przykład 3: Error rate (errors/min)
# Base (0): Green - brak błędów
# 1: Yellow - pojedyncze błędy
# 10: Orange - podwyższona liczba
# 50: Red - krytyczna liczba błędów
```

### Value mappings

Mapowanie wartości na tekst:

```yaml
# Przykład - Range mapping dla klasyfikacji:
# 0-50 → \"Low\"
# 51-75 → \"Medium\"
# 76-90 → \"High\"
# 91-100 → \"Critical\"
```

### Text size

**Title**: Rozmiar tytułu panelu
**Value**: Rozmiar wartości na paskach

## Przykłady zastosowania

### Przykład 1: Lista serwerów - wykorzystanie CPU

```PromQL
# Zapytanie
100 - (avg by(instance) (rate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100)
```

**Konfiguracja**:
- **Orientation**: Horizontal
- **Display mode**: Basic
- **Calculation**: Last (not null)
- **Unit**: `percent (0-100)`
- **Min**: 0, **Max**: 100
- **Decimals**: 1
- **Thresholds**:
  - Base (0): Green
  - 70: Yellow
  - 85: Orange
  - 95: Red
- **Show unfilled area**: On

### Przykład 2: Wykorzystanie partycji dyskowych

```PromQL
# Zapytanie
100 - ((node_filesystem_avail_bytes / node_filesystem_size_bytes) * 100)
```

**Konfiguracja**:
- **Orientation**: Horizontal
- **Display mode**: Gradient
- **Unit**: `percent (0-100)`
- **Min**: 0, **Max**: 100
- **Decimals**: 1
- **Thresholds**:
  - Base (0): Green (dużo miejsca)
  - 80: Yellow (zaczyna się kończyć)
  - 90: Orange (mało miejsca)
  - 95: Red (krytycznie mało)

### Przykład 3: Ranking endpoint'ów - liczba requestów

```PromQL
# Zapytanie
topk(10, sum by (endpoint) (rate(http_requests_total[5m])))
```

**Konfiguracja**:
- **Orientation**: Horizontal
- **Display mode**: Basic
- **Unit**: `requests/sec`
- **Decimals**: 0
- **Color scheme**: Single color (blue)
- **Show unfilled area**: Off
- **Display name**: `${__field.labels.endpoint}`

### Przykład 4: Czas odpowiedzi wielu API

```PromQL
# Zapytanie
histogram_quantile(0.95, sum by (api, le) (rate(http_request_duration_seconds_bucket[5m]))) * 1000
```

**Konfiguracja**:
- **Orientation**: Vertical
- **Display mode**: Gradient
- **Unit**: `milliseconds (ms)`
- **Min**: 0, **Max**: 1000
- **Decimals**: 0
- **Thresholds**:
  - Base (0): Green
  - 200: Yellow
  - 500: Orange
  - 1000: Red

### Przykład 5: Status serwisów (Up/Down)

```PromQL
# Zapytanie
up{job=~\".*\"}
```

**Konfiguracja**:
- **Orientation**: Horizontal
- **Display mode**: Basic
- **Min**: 0, **Max**: 1
- **Decimals**: 0
- **Value mappings**:
  - 0 → \"DOWN\"
  - 1 → \"UP\"
- **Thresholds**:
  - Base (0): Red
  - 1: Green
- **Display name**: `${__field.labels.job}`

### Przykład 6: Wykorzystanie RAM - wiele serwerów

```PromQL
# Zapytanie
(1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100
```

**Konfiguracja**:
- **Orientation**: Horizontal
- **Display mode**: LCD (retro style)
- **Unit**: `percent (0-100)`
- **Min**: 0, **Max**: 100
- **Decimals**: 1
- **Thresholds**:
  - Base (0): Green
  - 75: Yellow
  - 90: Orange
  - 98: Red

## Najlepsze praktyki

### Kiedy używać Bar gauge

**Użyj Bar gauge gdy**:
```yaml
✓ Masz wiele podobnych metryk do porównania (lista serwerów)
✓ Metryki mają określony zakres (0-100% lub 0-max)
✓ Potrzebujesz kompaktowej wizualizacji (więcej metryk na mniejszej przestrzeni)
✓ Ranking/Top N jest ważny
✓ Potrzebujesz szybkiego przeglądu wielu wartości
✓ Kolor paska ma znaczenie (progi krytyczności)
```

**NIE używaj Bar gauge gdy**:
```yaml
✗ Masz tylko 1-2 metryki (użyj Gauge lub Stat)
✗ Potrzebujesz pokazać trend w czasie (użyj Time series)
✗ Metryki są bardzo różnorodne (różne jednostki) - użyj Table
✗ Potrzebujesz szczegółowych danych liczbowych - użyj Table
✗ Dane nie mają górnej granicy (unbounded metrics)
```

### Bar gauge vs inne wizualizacje

**Bar gauge vs Gauge**:
```yaml
Bar gauge:
- Kompaktowy, idealny dla wielu metryk
- Prostszy wizualnie (pasek zamiast łuku)
- Lepszy dla list i rankingów
- Zajmuje mniej miejsca

Gauge:
- Bardziej analogowy, \"wskaźnikowy\" wygląd
- Lepszy dla pojedynczych kluczowych metryk
- Bardziej intuicyjny dla użytkowników nietechnicznych
```

**Bar gauge vs Stat**:
```yaml
Bar gauge:
- Wizualny pasek postępu
- Łatwiej ocenić \"jak pełny\"
- Lepszy dla metryk z zakresem

Stat:
- Skupia się na wartości numerycznej
- Może pokazać trend (sparkline)
- Bardziej minimalistyczny
```

**Bar gauge vs Table**:
```yaml
Bar gauge:
- Wizualna reprezentacja wartości
- Szybsza ocena statusu (kolor)
- Mniej szczegółów numerycznych

Table:
- Więcej kolumn z dodatkowymi danymi
- Dokładne wartości liczbowe
- Sortowanie, filtrowanie
```

### Układ i rozmiar

**Orientation - Horizontal**:
```yaml
Użyj gdy:
- Nazwy metryk są długie (hostname, URL)
- Masz 3-20 metryk do wyświetlenia
- Chcesz tradycyjny wygląd \"pasków postępu\"
- Panel jest szeroki

Rozmiar: 
- Wysokość: 200-400px (zależy od liczby metryk)
- Szerokość: 4-12 grid units (pełna szerokość lub połowa)
```

**Orientation - Vertical**:
```yaml
Użyj gdy:
- Nazwy metryk są krótkie (CPU, RAM, API1)
- Masz wiele metryk (>15)
- Chcesz zaoszczędzić wysokość panelu
- Panel jest wąski

Rozmiar:
- Wysokość: 150-250px
- Szerokość: 6-12 grid units
```

### Display mode

**Basic** (najczęściej używany):
```yaml
- Jednolity, czysty wygląd
- Jasno widoczny kolor progu
- Profesjonalny, nie rozpraszający
- Użyj dla dashboardów produkcyjnych
```

**Gradient**:
```yaml
- Estetyczny, gładki wygląd
- Przejścia między kolorami progów
- Dobry dla prezentacji biznesowych
- Może być mniej czytelny przy małych paskach
```

**LCD**:
```yaml
- Retro, segmentowany wygląd
- Unikalny styl wizualny
- Dobry dla dashboardów tematycznych
- Mniej profesjonalny dla środowisk korporacyjnych
```

### Progi i kolory

**Schemat 4-progowy** (najpopularniejszy):
```yaml
Green (0-70%): Normalne, bezpieczne wykorzystanie
Yellow (70-85%): Zwróć uwagę, może wymaga akcji
Orange (85-95%): Wysokie, wymaga monitorowania
Red (95-100%): Krytyczne, natychmiastowa akcja
```

**Pojedynczy kolor** (dla rankingów):
```yaml
# Użyj Single color gdy:
- Nie ma \"dobrego\" vs \"złego\" stanu
- Ranking/porównanie bez krytyczności
- Przykład: Top endpoints by traffic
```

**Schemat odwrócony** (dla availability):
```yaml
Red (0-90%): Niska dostępność - źle
Orange (90-95%): Poniżej celu
Yellow (95-99%): Akceptowalne
Green (99-100%): Doskonałe - cel osiągnięty
```

### Czytelność etykiet

**Długie nazwy** - używaj Display name:
```yaml
# Źle (pełna nazwa):
node_cpu_seconds_total{instance=\"prod-server-01.company.com:9100\"}

# Dobrze (skrócona):
Display name: ${__field.labels.instance:regex:\"([^.]+).*\"}
Wynik: \"prod-server-01\"
```

**Grupowanie podobnych metryk**:
```yaml
# Użyj wspólnego prefiksu w Display name:
${__field.labels.env} - ${__field.labels.instance}
Wynik: 
- \"prod - server-01\"
- \"prod - server-02\"
- \"staging - server-01\"
```

### Limitowanie liczby pasków

Bar gauge staje się nieczytelny przy zbyt wielu elementach:

```PromQL
# Źle - zbyt wiele pasków (100+ serwerów)
node_cpu_percent

# Dobrze - Top 20
topk(20, node_cpu_percent)

# Dobrze - filtrowanie
node_cpu_percent{env=\"production\"}

# Dobrze - Bottom 10 (najmniej obciążone)
bottomk(10, node_cpu_percent)
```

**Zalecenia**:
- **Horizontal**: maksymalnie 20-25 pasków
- **Vertical**: maksymalnie 30-40 pasków
- Powyżej tych limitów: rozważ filtrowanie, agregację lub podział na wiele paneli

## Rozwiązywanie problemów

**Paski nie wyświetlają się**:
1. Sprawdź Min/Max - wartości mogą być poza zakresem
2. Calculation może zwracać null - użyj \"Last (not null)\"
3. Zweryfikuj zapytanie w Explore
4. Sprawdź Unit - upewnij się że pasuje do wartości

**Wszystkie paski są tego samego koloru**:
1. Sprawdź Thresholds - muszą być poprawnie ustawione
2. Color scheme musi być \"From thresholds\"
3. Wartości mogą być wszystkie w tym samym przedziale progowym
4. Upewnij się że Base threshold jest ustawiony

**Etykiety są ucięte/niewidoczne**:
1. Zwiększ szerokość panelu
2. Skróć nazwy używając Display name
3. Użyj Orientation: Horizontal dla długich nazw
4. Zmniejsz Text size jeśli za duży

**Za dużo pasków, nieczytelne**:
1. Ogranicz liczbę używając topk() lub bottomk()
2. Dodaj filtering w zapytaniu
3. Podziel na wiele paneli (np. prod/staging osobno)
4. Użyj Table zamiast Bar gauge

**Gradient jest niewidoczny**:
1. Display mode → Gradient może być za subtelny
2. Zwiększ kontrast między progami (więcej przestrzeni między wartościami)
3. Użyj Basic display mode dla wyraźniejszych kolorów
4. Sprawdź czy Show unfilled area jest On

**Paski są za wąskie/szerokie**:
1. Dostosuj Min width i Max width
2. Zmień rozmiar panelu
3. Orientation → zmień między Horizontal/Vertical
4. Zmniejsz liczbę pasków

**Wartości nie sortują się poprawnie**:
1. Grafana sortuje alfabetycznie, nie numerycznie
2. Użyj sort_desc() w PromQL
3. Dla SQL użyj ORDER BY w zapytaniu
4. Display name może wpływać na sortowanie
