# Web UI - Targets, Rules, Alerts, Graph, Status

Prometheus posiada wbudowany interfejs webowy dostÄ™pny domyÅ›lnie na porcie **9090**. Web UI pozwala na interaktywne zarzÄ…dzanie i monitorowanie Prometheusa, wykonywanie zapytaÅ„ PromQL, przeglÄ…danie statusu targetÃ³w, reguÅ‚ alertowych i samego serwera.

## DostÄ™p do Web UI

```bash
# DomyÅ›lny URL
http://localhost:9090

# Lub z adresem IP serwera
http://10.123.3.12:9090
```

**Sprawdzenie czy Prometheus nasÅ‚uchuje:**

```bash
# SprawdÅº status usÅ‚ugi
sudo systemctl status prometheus

# SprawdÅº port
sudo netstat -tulpn | grep 9090
```

## GÅ‚Ã³wne sekcje Web UI

### Menu nawigacyjne

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Prometheus [logo]                            â”‚
â”‚                                              â”‚
â”‚ [Graph] [Alerts] [Status â–¼] [Help]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 1. Graph - Eksplorator metryk i zapytaÅ„

Sekcja **Graph** to gÅ‚Ã³wne miejsce do wykonywania zapytaÅ„ PromQL i wizualizacji metryk.

### Interfejs Graph

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Expression: [node_cpu_seconds_total] ğŸ”         â”‚
â”‚                                                 â”‚
â”‚ â˜ Use local time                                â”‚
â”‚ Evaluation time: [now]                          â”‚
â”‚                                                 â”‚
â”‚ [Execute] [Add Graph]                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š Graph    ğŸ“‹ Table                            â”‚
â”‚                                                 â”‚
â”‚ [Wykres lub tabela z wynikami]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Podstawowe uÅ¼ycie

1. **Wpisz zapytanie** w polu Expression
2. **Kliknij Execute** lub naciÅ›nij `Shift+Enter`
3. **Wybierz widok:**
   - **Graph** - wykres liniowy z metrykami w czasie
   - **Table** - tabela z aktualnymi wartoÅ›ciami

### PrzykÅ‚adowe zapytania

#### Wykorzystanie CPU (%)

```promql
100 - (avg by (instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)
```

#### Wykorzystanie pamiÄ™ci RAM (%)

```promql
100 * (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes))
```

#### Wolne miejsce na dysku (GB)

```promql
node_filesystem_avail_bytes{fstype=~"ext4|xfs"} / 1024 / 1024 / 1024
```

#### Transfer sieciowy (MB/s)

```promql
rate(node_network_receive_bytes_total[5m]) / 1024 / 1024
```

### Funkcje zaawansowane w Graph

#### 1. **Zakres czasowy**

```
[- 5m] [- 15m] [- 30m] [- 1h] [- 3h] [- 6h] [- 12h] [- 1d] [- 1w]
```

Kliknij przycisk lub uÅ¼yj pÃ³l daty:

```
From: [2026-02-04 10:00:00] To: [2026-02-04 12:00:00]
```

#### 2. **AutouzupeÅ‚nianie**

W polu Expression rozpocznij wpisywanie nazwy metryki:

```
node_me...
  â”œâ”€ node_memory_MemTotal_bytes
  â”œâ”€ node_memory_MemFree_bytes
  â”œâ”€ node_memory_MemAvailable_bytes
  â””â”€ node_memory_Cached_bytes
```

#### 3. **Parametry zapytania**

- **Step** - interwaÅ‚ prÃ³bkowania danych
- **Resolution** - rozdzielczoÅ›Ä‡ wykresu
- **Timeout** - maksymalny czas wykonania zapytania

### Tips & Tricks dla Graph

```promql
# SprawdÅº dostÄ™pne metryki dla danego job
{job="node_exporter"}

# ZnajdÅº metryki zawierajÄ…ce sÅ‚owo "memory"
{__name__=~".*memory.*"}

# Filtruj po etykiecie
node_cpu_seconds_total{instance="localhost:9100"}

# Agregacja
sum(rate(node_cpu_seconds_total{mode!="idle"}[5m])) by (instance)
```

## 2. Alerts - ZarzÄ…dzanie alertami

Sekcja **Alerts** pokazuje wszystkie zdefiniowane alerty i ich aktualny stan.

### Interfejs Alerts

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Alerts                                           â”‚
â”‚                                                  â”‚
â”‚ ğŸ”´ Firing (2)                                    â”‚
â”‚   â”œâ”€ HighCPUUsage                                â”‚
â”‚   â”‚   Severity: warning                          â”‚
â”‚   â”‚   Instance: localhost:9100                   â”‚
â”‚   â”‚   CPU usage is above 80%                     â”‚
â”‚   â”‚   [Active for: 5m]                           â”‚
â”‚   â”‚                                              â”‚
â”‚   â””â”€ DiskSpaceLow                                â”‚
â”‚       Severity: critical                         â”‚
â”‚       Instance: server01:9100                    â”‚
â”‚       Disk space below 10%                       â”‚
â”‚       [Active for: 2h]                           â”‚
â”‚                                                  â”‚
â”‚ ğŸŸ¡ Pending (1)                                   â”‚
â”‚   â””â”€ HighMemoryUsage                             â”‚
â”‚       Severity: warning                          â”‚
â”‚       [Active for: 2m / 5m threshold]            â”‚
â”‚                                                  â”‚
â”‚ ğŸŸ¢ Inactive (15)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Stany alertÃ³w

| Stan | Opis | Kolor |
|------|------|-------|
| **Inactive** | Alert nieaktywny, warunek nie jest speÅ‚niony | ğŸŸ¢ Zielony |
| **Pending** | Warunek speÅ‚niony, ale nie minÄ…Å‚ czas `for` | ğŸŸ¡ Å»Ã³Å‚ty |
| **Firing** | Alert aktywny, warunek speÅ‚niony przez wymagany czas | ğŸ”´ Czerwony |

### PrzykÅ‚ad definicji alertu

Alerty definiuje siÄ™ w plikach reguÅ‚ (np. `/etc/prometheus/rules/alerts.yml`):

```yaml
groups:
  - name: system_alerts
    interval: 30s
    rules:
      - alert: HighCPUUsage
        expr: 100 - (avg by (instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High CPU usage on {{ $labels.instance }}"
          description: "CPU usage is {{ $value }}% (threshold: 80%)"
```

**WyjaÅ›nienie parametrÃ³w:**

- **alert** - nazwa alertu
- **expr** - zapytanie PromQL okreÅ›lajÄ…ce warunek alertu
- **for** - czas przez jaki warunek musi byÄ‡ speÅ‚niony
- **labels** - dodatkowe etykiety (np. severity)
- **annotations** - opis alertu (summary, description)

### Filtrowanie alertÃ³w w UI

```
ğŸ” Filter: [severity=critical]

# MoÅ¼liwe filtry:
- alertname="HighCPUUsage"
- severity="critical"
- instance="localhost:9100"
```

## 3. Status - Informacje o systemie Prometheusa

Menu **Status** zawiera wiele podstron z informacjami diagnostycznymi.

### Status > Runtime & Build Information

Informacje o wersji i konfiguracji Prometheusa:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Runtime Information                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Start time:      2026-02-04 08:00:00    â”‚
â”‚ Working directory: /var/lib/prometheus   â”‚
â”‚ Configuration file: /etc/prometheus/...  â”‚
â”‚ Storage retention: 15d                   â”‚
â”‚ TSDB path:       /var/lib/prometheus/... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Build Information                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Version:         2.49.1                  â”‚
â”‚ Revision:        af3ba6f8a0...           â”‚
â”‚ Branch:          HEAD                    â”‚
â”‚ BuildUser:       root@buildkitsandbox    â”‚
â”‚ BuildDate:       20240131-12:34:56       â”‚
â”‚ Go Version:      go1.21.6                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Status > Command-Line Flags

Parametry z jakimi uruchomiono Prometheus:

```
--config.file=/etc/prometheus/prometheus.yml
--storage.tsdb.path=/var/lib/prometheus/
--storage.tsdb.retention.time=15d
--web.console.libraries=/usr/share/prometheus/console_libraries
--web.console.templates=/usr/share/prometheus/consoles
--web.enable-lifecycle
--web.listen-address=0.0.0.0:9090
```

**NajwaÅ¼niejsze flagi:**

- **--config.file** - Å›cieÅ¼ka do pliku konfiguracyjnego
- **--storage.tsdb.path** - katalog z bazÄ… danych
- **--storage.tsdb.retention.time** - jak dÅ‚ugo przechowywaÄ‡ dane (np. 15d)
- **--storage.tsdb.retention.size** - maksymalny rozmiar bazy danych
- **--web.listen-address** - adres i port nasÅ‚uchiwania
- **--web.enable-lifecycle** - wÅ‚Ä…cza API do przeÅ‚adowania konfiguracji

### Status > Configuration

Aktualna konfiguracja Prometheusa w formacie YAML. To jest **zrenderowana** wersja pliku `/etc/prometheus/prometheus.yml`.

```yaml
global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    monitor: 'prometheus-01'

scrape_configs:
  - job_name: prometheus
    static_configs:
      - targets:
          - localhost:9090

  - job_name: node_exporter
    static_configs:
      - targets:
          - localhost:9100
        labels:
          hostname: ubuntu-server-01
```

**Przydatne:** MoÅ¼esz zweryfikowaÄ‡ czy konfiguracja zostaÅ‚a poprawnie zaÅ‚adowana po reload.

### Status > Rules

Lista wszystkich zaÅ‚adowanych reguÅ‚ (alerting rules i recording rules):

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Rules                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ File: /etc/prometheus/rules/alerts.yml            â”‚
â”‚ â”œâ”€ Group: system_alerts                           â”‚
â”‚ â”‚  â”œâ”€ HighCPUUsage (alert)                        â”‚
â”‚ â”‚  â”œâ”€ HighMemoryUsage (alert)                     â”‚
â”‚ â”‚  â””â”€ DiskSpaceLow (alert)                        â”‚
â”‚ â”‚                                                  â”‚
â”‚ â””â”€ Group: recording_rules                         â”‚
â”‚    â”œâ”€ instance:cpu:rate5m (recording)             â”‚
â”‚    â””â”€ instance:memory:usage (recording)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Typy reguÅ‚:**

1. **Alerting Rules** - generujÄ… alerty
2. **Recording Rules** - pre-obliczajÄ… zapytania i zapisujÄ… jako nowe metryki

### Status > Targets

**NajwaÅ¼niejsza sekcja!** Pokazuje wszystkie monitorowane cele (targets) i ich stan.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Targets                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŸ¢ up (3/3)                                               â”‚
â”‚                                                          â”‚
â”‚ â–¼ node_exporter (2/2 up)                                â”‚
â”‚   ğŸŸ¢ http://localhost:9100/metrics                       â”‚
â”‚      State: UP                                           â”‚
â”‚      Labels: hostname=ubuntu-01, job=node_exporter       â”‚
â”‚      Last Scrape: 2.5s ago                              â”‚
â”‚      Scrape Duration: 45ms                              â”‚
â”‚      Error: none                                        â”‚
â”‚                                                          â”‚
â”‚   ğŸŸ¢ http://10.123.3.12:9100/metrics                    â”‚
â”‚      State: UP                                           â”‚
â”‚      Labels: hostname=ubuntu-02, job=node_exporter       â”‚
â”‚      Last Scrape: 1.8s ago                              â”‚
â”‚      Scrape Duration: 52ms                              â”‚
â”‚      Error: none                                        â”‚
â”‚                                                          â”‚
â”‚ â–¼ prometheus (1/1 up)                                   â”‚
â”‚   ğŸŸ¢ http://localhost:9090/metrics                       â”‚
â”‚      State: UP                                           â”‚
â”‚      Last Scrape: 3.1s ago                              â”‚
â”‚      Scrape Duration: 12ms                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Stany targetÃ³w:**

- **ğŸŸ¢ UP** - target odpowiada i metryki sÄ… zbierane
- **ğŸ”´ DOWN** - target nie odpowiada
- **âšª UNKNOWN** - target jeszcze nie byÅ‚ sprawdzany

**Informacje o targecie:**

- **State** - aktualny stan (UP/DOWN)
- **Labels** - etykiety przypisane do targetu
- **Last Scrape** - kiedy ostatnio pobierano metryki
- **Scrape Duration** - jak dÅ‚ugo trwaÅ‚o pobieranie
- **Error** - komunikat bÅ‚Ä™du (jeÅ›li jest)

### Status > Service Discovery

Pokazuje wykryte targets przez mechanizmy service discovery:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Service Discovery                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Job: node_exporter                             â”‚
â”‚ Discovery: static_configs                      â”‚
â”‚                                                â”‚
â”‚ Discovered targets:                            â”‚
â”‚ â”œâ”€ localhost:9100                              â”‚
â”‚ â”‚  __address__="localhost:9100"                â”‚
â”‚ â”‚  __metrics_path__="/metrics"                 â”‚
â”‚ â”‚  __scheme__="http"                           â”‚
â”‚ â”‚  hostname="ubuntu-01"                        â”‚
â”‚ â”‚  job="node_exporter"                         â”‚
â”‚ â””â”€ 10.123.3.12:9100                           â”‚
â”‚    __address__="10.123.3.12:9100"             â”‚
â”‚    hostname="ubuntu-02"                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Mechanizmy service discovery:**

- **static_configs** - rÄ™cznie zdefiniowane targets
- **consul_sd_configs** - wykrywanie przez Consul
- **dns_sd_configs** - wykrywanie przez DNS
- **kubernetes_sd_configs** - wykrywanie w Kubernetes
- **ec2_sd_configs** - wykrywanie w AWS EC2

### Status > TSDB Status

Informacje o bazie danych Time Series Database:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TSDB Status                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Head Block:                                    â”‚
â”‚ â”œâ”€ Min Time: 2026-02-04 10:00:00              â”‚
â”‚ â”œâ”€ Max Time: 2026-02-04 12:00:00              â”‚
â”‚ â”œâ”€ Chunks: 234,567                             â”‚
â”‚ â”œâ”€ Series: 12,345                              â”‚
â”‚ â””â”€ Samples: 45,678,901                         â”‚
â”‚                                                â”‚
â”‚ Blocks:                                        â”‚
â”‚ â”œâ”€ Block 01HQWXYZ... (2026-02-01)             â”‚
â”‚ â”‚  Duration: 2h                                â”‚
â”‚ â”‚  Series: 10,234                              â”‚
â”‚ â”‚  Samples: 23,456,789                         â”‚
â”‚ â”‚  Size: 45.3 MB                               â”‚
â”‚ â””â”€ Block 01HQWXAB... (2026-02-02)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Metryki TSDB:**

- **Head Block** - aktualny blok w pamiÄ™ci (jeszcze nie zapisany na dysk)
- **Chunks** - kompresowane serie danych
- **Series** - unikalne kombinacje metryki + etykiet
- **Samples** - pojedyncze punkty danych

## 4. Targets - SzczegÃ³Å‚owy przeglÄ…d

### Diagnozowanie problemÃ³w z targets

#### Target DOWN - Przyczyny

1. **Service nie dziaÅ‚a**

```bash
# SprawdÅº status Node Exporter
sudo systemctl status node_exporter

# Uruchom jeÅ›li nie dziaÅ‚a
sudo systemctl start node_exporter
```

2. **Firewall blokuje poÅ‚Ä…czenie**

```bash
# SprawdÅº firewall
sudo ufw status

# OtwÃ³rz port
sudo ufw allow 9100/tcp
```

3. **BÅ‚Ä™dny adres w konfiguracji**

```yaml
# BÅ‚Ä…d: nieprawidÅ‚owy hostname lub port
static_configs:
  - targets: ['wrong-hostname:9100']

# Poprawka: uÅ¼yj IP lub poprawnego hostname
static_configs:
  - targets: ['10.123.3.12:9100']
```

4. **Problem z sieciÄ…**

```bash
# Test poÅ‚Ä…czenia z Prometheusa
curl http://10.123.3.12:9100/metrics

# Test DNS
nslookup hostname
ping hostname
```

### Filtrowanie targets

```
# PokaÅ¼ tylko DOWN targets
Filter: state="down"

# PokaÅ¼ konkretny job
Filter: job="node_exporter"
```

### Etykiety targets

**Wbudowane etykiety (internal labels):**

- `__address__` - adres targetu
- `__metrics_path__` - Å›cieÅ¼ka do metryk (domyÅ›lnie `/metrics`)
- `__scheme__` - protokÃ³Å‚ (http/https)
- `__param_<name>` - parametry URL

**Etykiety niestandardowe:**

```yaml
scrape_configs:
  - job_name: 'node_exporter'
    static_configs:
      - targets: ['10.123.3.12:9100']
        labels:
          hostname: 'web-server-01'
          environment: 'production'
          datacenter: 'dc1'
          team: 'platform'
```

Te etykiety pojawiÄ… siÄ™ przy kaÅ¼dej metryce:

```
node_cpu_seconds_total{
  instance="10.123.3.12:9100",
  job="node_exporter",
  hostname="web-server-01",
  environment="production",
  datacenter="dc1",
  team="platform"
}
```

## 5. API HTTP Prometheusa

Web UI korzysta z API HTTP, ktÃ³re moÅ¼esz uÅ¼ywaÄ‡ programatowo.

### Podstawowe endpointy API

#### Zapytania o metryki

```bash
# Instant query - aktualna wartoÅ›Ä‡
curl 'http://localhost:9090/api/v1/query?query=up'

# Range query - seria czasowa
curl 'http://localhost:9090/api/v1/query_range?query=up&start=2026-02-04T10:00:00Z&end=2026-02-04T12:00:00Z&step=15s'
```

#### Metadane metryk

```bash
# Lista wszystkich metryk
curl http://localhost:9090/api/v1/label/__name__/values

# Etykiety dla metryki
curl 'http://localhost:9090/api/v1/series?match[]=node_cpu_seconds_total'
```

#### Status targetÃ³w

```bash
# Pobierz status wszystkich targets
curl http://localhost:9090/api/v1/targets

# Format z jq
curl -s http://localhost:9090/api/v1/targets | jq '.data.activeTargets[] | {instance: .labels.instance, state: .health}'
```

#### ZarzÄ…dzanie konfiguracjÄ…

```bash
# PrzeÅ‚aduj konfiguracjÄ™ (wymaga --web.enable-lifecycle)
curl -X POST http://localhost:9090/-/reload

# ZakoÅ„cz Prometheusa gracefully
curl -X POST http://localhost:9090/-/quit
```

### PrzykÅ‚ad: Automatyczne sprawdzanie targets

```bash
#!/bin/bash

# SprawdÅº DOWN targets
down_targets=$(curl -s http://localhost:9090/api/v1/targets | \
  jq -r '.data.activeTargets[] | select(.health=="down") | .labels.instance')

if [ -n "$down_targets" ]; then
  echo "âš ï¸ DOWN targets detected:"
  echo "$down_targets"
  # WyÅ›lij alert (email, Slack, etc.)
else
  echo "âœ… All targets are UP"
fi
```

## 6. Zabezpieczanie Web UI

### Basic Authentication

1. Zainstaluj apache2-utils:

```bash
sudo apt install apache2-utils
```

2. Wygeneruj hasÅ‚o:

```bash
htpasswd -nBC 10 admin | tr -d ':\n'
```

3. UtwÃ³rz plik konfiguracyjny `/etc/prometheus/web.yml`:

```yaml
basic_auth_users:
  admin: $2y$10$hashed_password_here
  viewer: $2y$10$another_hashed_password
```

4. Uruchom Prometheus z konfiguracjÄ…:

```bash
# W pliku systemd /etc/systemd/system/prometheus.service
ExecStart=/usr/local/bin/prometheus \
  --config.file=/etc/prometheus/prometheus.yml \
  --web.config.file=/etc/prometheus/web.yml \
  --storage.tsdb.path=/var/lib/prometheus/
```

5. Restart:

```bash
sudo systemctl daemon-reload
sudo systemctl restart prometheus
```

Teraz dostÄ™p do http://localhost:9090 wymaga logowania.

### TLS/HTTPS

Konfiguracja HTTPS w `/etc/prometheus/web.yml`:

```yaml
tls_server_config:
  cert_file: /etc/prometheus/certs/prometheus.crt
  key_file: /etc/prometheus/certs/prometheus.key
  client_auth_type: "NoClientCert"
```

### Reverse Proxy (Nginx)

Konfiguracja Nginx jako reverse proxy:

```nginx
server {
    listen 80;
    server_name prometheus.example.com;

    location / {
        proxy_pass http://localhost:9090;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        
        # Basic Auth na poziomie Nginx
        auth_basic "Prometheus";
        auth_basic_user_file /etc/nginx/.htpasswd;
    }
}
```

## Najlepsze praktyki Web UI

### 1. **Monitorowanie**
- Regularnie sprawdzaj sekcjÄ™ **Targets** - wszystkie powinny byÄ‡ UP
- Monitoruj **Alerts** - reaguj na firing alerts
- Sprawdzaj **TSDB Status** - upewnij siÄ™ Å¼e nie brakuje miejsca

### 2. **BezpieczeÅ„stwo**
- Zawsze wÅ‚Ä…czaj Basic Auth lub uÅ¼ywaj reverse proxy
- Ogranicz dostÄ™p przez firewall
- UÅ¼ywaj HTTPS w produkcji
- Audytuj dostÄ™p do Web UI

### 3. **WydajnoÅ›Ä‡ zapytaÅ„**
- Unikaj bardzo szerokich zakresÃ³w czasowych w Graph
- UÅ¼ywaj recording rules dla zÅ‚oÅ¼onych zapytaÅ„
- Ogranicz liczbÄ™ serii w jednym zapytaniu

### 4. **Organizacja**
- UÅ¼ywaj sensownych nazw dla alertÃ³w i reguÅ‚
- Grupuj targets wedÅ‚ug funkcji (job_name)
- Dokumentuj niestandardowe metryki i etykiety

## Przydatne skrÃ³ty klawiszowe

| SkrÃ³t | Akcja |
|-------|-------|
| `Shift + Enter` | Wykonaj zapytanie w Graph |
| `Ctrl + Space` | AutouzupeÅ‚nianie w polu Expression |
| `â†‘` / `â†“` | Historia zapytaÅ„ |
| `Tab` | PrzeÅ‚Ä…cz miÄ™dzy Graph a Table |

## Troubleshooting Web UI

### Problem: Web UI nie odpowiada

```bash
# SprawdÅº czy Prometheus dziaÅ‚a
sudo systemctl status prometheus

# SprawdÅº logi
sudo journalctl -u prometheus -f

# SprawdÅº port
sudo netstat -tulpn | grep 9090
```

### Problem: Targets nie pojawiajÄ… siÄ™

```bash
# SprawdÅº konfiguracjÄ™
promtool check config /etc/prometheus/prometheus.yml

# PrzeÅ‚aduj konfiguracjÄ™
curl -X POST http://localhost:9090/-/reload

# Lub restart
sudo systemctl restart prometheus
```

### Problem: Zapytania PromQL zwracajÄ… bÅ‚Ä™dy

```bash
# SprawdÅº skÅ‚adniÄ™ zapytania
promtool query instant http://localhost:9090 'up'

# Zobacz czy metryki istniejÄ…
curl http://localhost:9090/api/v1/label/__name__/values | grep node_cpu
```

## Podsumowanie

Web UI Prometheusa to potÄ™Å¼ne narzÄ™dzie do:
- ğŸ“Š **Graph** - testowania zapytaÅ„ PromQL i wizualizacji metryk
- ğŸš¨ **Alerts** - monitorowania stanu alertÃ³w
- ğŸ¯ **Targets** - weryfikacji statusu monitorowanych celÃ³w
- âš™ï¸ **Status** - diagnostyki i konfiguracji Prometheusa

Dla produkcyjnego uÅ¼ycia, Web UI Å›wietnie sprawdza siÄ™ do ad-hoc queries i diagnostyki, ale do dashboardÃ³w uÅ¼ywaj Grafany.
