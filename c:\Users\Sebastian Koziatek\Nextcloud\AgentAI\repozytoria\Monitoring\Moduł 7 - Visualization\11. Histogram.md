# Histogram – rozkład wartości

## Charakterystyka

**Histogram** to wizualizacja przedstawiająca rozkład wartości w formie słupków. Każdy słupek reprezentuje liczbę wystąpień wartości w określonym przedziale (bucket). Jest to snapshot rozkładu w wybranym przedziale czasowym. Idealne do:

- Analizy rozkładu latency (percentile visualization)
- Identyfikacji outliers i anomalii w danych
- Porównywania rozkładów między różnymi okresami
- Oceny SLA compliance (ile requestów < threshold)
- Analizy performance characteristics aplikacji
- Wykrywania bi-modal lub multi-modal distributions

**Kiedy używać Histogram**:
- Chcesz zobaczyć jak wartości są rozłożone (distribution shape)
- Analizujesz percentile i medianę
- Sprawdzasz czy większość wartości mieści się w zakresie (SLA)
- Porównujesz rozkłady w różnych okresach czasu

**Kiedy NIE używać Histogram**:
- Chcesz zobaczyć zmiany w czasie - użyj Time series lub Heatmap
- Interesuje cię konkretna wartość - użyj Stat lub Gauge
- Potrzebujesz tabelarycznych danych - użyj Table

**Różnica vs Heatmap**:
- **Histogram** - snapshot rozkładu w jednym momencie/okresie (1D)
- **Heatmap** - histogram w czasie, pokazuje jak rozkład zmienia się (2D)

## Konfiguracja

### Histogram options

**Bucket size**: Szerokość przedziałów
- **Auto** - Grafana automatycznie oblicza
- **Custom** - ręczne ustawienie (np. 0.1s dla latency)

**Bucket offset**: Przesunięcie początku pierwszego bucket
- Zazwyczaj 0

### Display options

**Bar alignment**: 
- **Before** - słupek zaczyna się przed wartością bucket
- **Center** - słupek wycentrowany na wartości (rekomendowane)
- **After** - słupek zaczyna się po wartości

**Line width**: Grubość linii obrysowania słupków (0-10px)

**Fill opacity**: Przezroczystość wypełnienia słupków (0-100%)

### Legend, Axis, Standard options

Standardowe opcje jak w innych wizualizacjach - jednostki, kolory, legendy.

## Przykłady

### Przykład 1: Rozkład latency API

**Zapytanie** (Prometheus histogram):
```promql
sum(increase(http_request_duration_seconds_bucket{job="api"}[5m])) by (le)
```

**Konfiguracja**:
- Bucket size: Auto
- Bar alignment: Center
- X-axis unit: seconds (s)
- Y-axis unit: short (requests)

**Wynik**: Histogram pokazujący ile requestów miało latency w przedziale 0-0.1s, 0.1-0.5s, 0.5-1s, itd.

**Interpretacja**: Większość słupków powinna być po lewej (low latency). Długi "ogon" po prawej = outliers.

---

### Przykład 2: CPU usage distribution

**Zapytanie**:
```promql
avg_over_time(node_cpu_seconds_total{mode!="idle"}[1h])
```

**Konfiguracja**:
- Bucket size: 10 (10% intervals)
- X-axis: Percent (0-100)

**Wynik**: Rozkład pokazujący jak często CPU był w danym przedziale wykorzystania.

---

### Przykład 3: Response size distribution

**Zapytanie**:
```promql
sum(rate(http_response_size_bytes_bucket[10m])) by (le)
```

**Wynik**: Rozkład rozmiarów odpowiedzi HTTP - identyfikacja unusually large responses.

## Best practices

**Bucket size**:
- Za mało buckets (<5) - loss of detail
- Za dużo buckets (>50) - noisy, hard to read
- Optimal: 10-30 buckets

**Zakres czasowy**:
- Histogram to snapshot - wybierz reprezentatywny okres
- Dla real-time: Last 5-15 minutes
- Dla analysis: Last 1-24 hours
- Dla comparison: użyj dashboard variables aby porównać różne okresy

**Porównywanie okresów**:
Stwórz wiele paneli histogram obok siebie z różnymi time ranges:
- Panel 1: Last hour
- Panel 2: Same hour yesterday
- Panel 3: Same hour last week

**Kombinacje**:
- **Histogram + Stat**: Stat pokazuje p95, Histogram pokazuje cały rozkład
- **Histogram + Time series**: Time series pokazuje trend p50/p95 w czasie, Histogram pokazuje current distribution

## Troubleshooting

**Histogram pusty**: Sprawdź czy zapytanie zwraca histogram buckets (label `le`)

**Zbyt mało/wiele słupków**: Dostosuj Bucket size

**Weird distribution shape**: Upewnij się że używasz sum/increase dla counter metrics, nie rate

**Outliers dominują**: Rozważ logarithmic scale lub filtering extreme values

## Prometheus histogram metrics

Dla Prometheus histograms używaj zawsze zapytań z `_bucket`:
```promql
# DOBRZE
sum(rate(metric_bucket[5m])) by (le)

# ŹLE - to nie zadziała dla histogram
avg(metric)
```

Percentile z histogram:
```promql
histogram_quantile(0.95, sum(rate(metric_bucket[5m])) by (le))
```
