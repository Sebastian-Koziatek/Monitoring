# Gauge

Gauge to wizualizacja przedstawiająca pojedynczą wartość w formie półkolistego lub kolistego wskaźnika (licznika). Przypomina tradycyjne wskaźniki analogowe znane z tablic rozdzielczych samochodów czy przemysłowych paneli sterowania. Gauge jest idealny do wyświetlania metryk, które mają określony zakres i gdzie wizualna reprezentacja "zapełnienia" jest intuicyjna.

## Charakterystyka wizualizacji

Wizualizacja Gauge składa się z:
- **Łuk wskaźnika**: Półkoliste lub pełne koło pokazujące zakres wartości
- **Wskazówka/wypełnienie**: Pokazuje aktualną wartość na łuku
- **Wartość numeryczna**: Centralna, duża liczba z jednostką
- **Progi kolorystyczne**: Segmenty łuku w różnych kolorach według progów

Najczęstsze zastosowania:
- Wykorzystanie zasobów z określonym zakresem (CPU 0-100%, RAM 0-100%)
- Temperature systemu lub sprzętu (0-100°C)
- Poziom zapełnienia dysku (0-100% lub 0-capacity)
- Poziom baterii lub zasilania
- Ciśnienie, wilgotność, prędkość - metryki analogowe
- Wskaźniki efektywności (0-100%)
- Poziom serwisu (SLA 0-100%)

## Konfiguracja panelu

### Panel options

Standardowe opcje panelu (identyczne jak w innych wizualizacjach).

### Gauge settings

**Orientation**: Orientacja wskaźnika
- **Auto**: Automatyczny dobór (zazwyczaj horizontal)
- **Horizontal**: Poziomy łuk na dole panelu
- **Vertical**: Pionowy łuk po lewej stronie panelu

```yaml
# Horizontal: Najbardziej naturalne, przypomina klasyczne gauge
# Vertical: Dla oszczędności miejsca lub estetyki układu
```

**Show threshold labels**: Wyświetlanie etykiet progów na łuku
- **On**: Pokazuj wartości progów na skali
- **Off**: Ukryj etykiety progów (domyślnie)

**Show threshold markers**: Wyświetlanie markerów progów
- **On**: Pokazuj kolorowe segmenty według progów
- **Off**: Jednolity kolor łuku

**Sizing**: Sposób skalowania gauge
- **Auto**: Automatyczne dopasowanie do rozmiaru panelu (domyślnie)
- **Manual**: Ręczna kontrola rozmiaru
  - **Width**: Szerokość w pikselach
  - **Height**: Wysokość w pikselach

**Min width**: Minimalna szerokość gauge (w pikselach)
**Max width**: Maksymalna szerokość gauge (w pikselach)

**Neutral**: Wartość neutralna (punkt odniesienia)
- Określa punkt startowy wypełnienia wskaźnika
- Domyślnie: Min value
- Przydatne dla metryk z zerem pośrodku (temperatura -50 do +50)

### Calculation

Określa jaka wartość z serii jest wyświetlana:

**Calculation**:
- **Last (not null)**: Ostatnia niepusta wartość (domyślnie, najbardziej typowe)
- **Last**: Ostatnia wartość
- **Min**: Minimum z zakresu
- **Max**: Maksimum z zakresu
- **Mean**: Średnia
- **Sum**: Suma
- **Count**: Liczba pomiarów

```PromQL
# Przykłady:

# Last (not null) - aktualne wykorzystanie CPU
node_cpu_percent

# Max - szczytowa temperatura w ostatniej godzinie
max_over_time(system_temperature_celsius[1h])

# Mean - średnie zużycie RAM za ostatnie 15 min
avg_over_time(node_memory_percent[15m])
```

### Standard options

**Unit**: Jednostka miary
```yaml
# Typowe jednostki dla Gauge:
# - percent (0-100): Procenty dla wykorzystania zasobów
# - celsius (°C): Temperatura w Celsjuszach
# - fahrenheit (°F): Temperatura w Fahrenheitach
# - pressure (hPa): Ciśnienie atmosferyczne
# - humidity (%H): Wilgotność
# - bytes: Bajty (dla dysku)
# - rpm: Obrotów na minutę (dla wentylatorów)
# - volt (V): Napięcie
# - amp (A): Natężenie prądu
# - watt (W): Moc
```

**Min/Max**: Zakres wskaźnika
- **Min**: Minimalna wartość na skali (domyślnie: 0)
- **Max**: Maksymalna wartość na skali (domyślnie: 100)

```yaml
# Przykłady zakresów:
# CPU/RAM: Min: 0, Max: 100 (procenty)
# Temperatura: Min: 0, Max: 100 (Celsjusz)
# Dysk: Min: 0, Max: <capacity> (GB)
# SLA: Min: 0, Max: 100 (procenty)
# Ping latency: Min: 0, Max: 1000 (ms)
```

**Decimals**: Liczba miejsc po przecinku
- **Auto**: Grafana decyduje
- **0**: Liczby całkowite
- **1-2**: Standardowa precyzja

**Display name**: Nazwa wyświetlana
```
Przykład: ${__field.labels.instance} CPU Usage
```

**Color scheme**: Schemat kolorów
- **From thresholds (by value)**: Kolory według progów (najczęściej używane dla Gauge)
- **Single color**: Jeden kolor dla całego łuku
- **Classic palette**: Różne kolory dla wielu serii

**No value**: Tekst gdy brak danych
```
Domyślnie: "No data"
Własny: "N/A", "Offline"
```

### Thresholds

Progi są kluczowe dla Gauge - definiują kolorowe segmenty łuku:

**Mode**:
- **Absolute**: Stałe wartości progowe
- **Percentage**: Progi procentowe (0-100)

**Base**: Kolor bazowy (dla wartości poniżej pierwszego progu)

**Steps**: Definicja progów i kolorów
```yaml
# Przykład 1: CPU/RAM Usage (0-100%)
# Base (0): Green - niskie wykorzystanie
# 70: Yellow - średnie wykorzystanie
# 85: Orange - wysokie wykorzystanie
# 95: Red - krytyczne wykorzystanie

# Przykład 2: Temperatura (0-100°C)
# Base (0): Blue - zimno
# 40: Green - normalna temperatura
# 60: Yellow - podwyższona temperatura
# 80: Orange - wysoka temperatura
# 95: Red - krytyczna temperatura

# Przykład 3: Disk Space (0-capacity GB)
# Base (0): Green - dużo miejsca
# 70% capacity: Yellow - zwróć uwagę
# 85% capacity: Orange - brakuje miejsca
# 95% capacity: Red - pilnie potrzebne czyszczenie
```

**Show threshold markers**: Wyświetlanie markerów
- **On**: Pokazuj kolorowe segmenty na łuku (domyślnie dla Gauge)
- **Off**: Jednolity łuk

**Show threshold labels**: Wyświetlanie wartości progów
- **On**: Pokazuj liczby na skali łuku
- **Off**: Ukryj wartości

### Value mappings

Mapowanie wartości liczbowych na teksty:

```yaml
# Przykład - Status w procentach:
# 0-25 → "Critical"
# 26-50 → "Low"
# 51-75 → "Medium"
# 76-90 → "Good"
# 91-100 → "Excellent"
```

### Text size

**Title**: Rozmiar tytułu panelu
**Value**: Rozmiar centralnej wartości na Gauge

### Repeat options

Automatyczne powielanie panelu dla każdej wartości zmiennej.

## Przykłady zastosowania

### Przykład 1: Wykorzystanie CPU

```PromQL
# Zapytanie
100 - (avg(rate(node_cpu_seconds_total{mode="idle",instance="prod-01"}[5m])) * 100)
```

**Konfiguracja**:
- **Calculation**: Last (not null)
- **Unit**: `percent (0-100)`
- **Min**: 0, **Max**: 100
- **Decimals**: 1
- **Orientation**: Horizontal
- **Show threshold markers**: On
- **Show threshold labels**: On
- **Thresholds**:
  - Base (0): Green
  - 70: Yellow
  - 85: Orange
  - 95: Red

### Przykład 2: Temperatura CPU

```PromQL
# Zapytanie
node_hwmon_temp_celsius{chip="coretemp-isa-0000",sensor="temp1"}
```

**Konfiguracja**:
- **Calculation**: Last (not null)
- **Unit**: `celsius (°C)`
- **Min**: 0, **Max**: 100
- **Decimals**: 0
- **Orientation**: Horizontal
- **Thresholds**:
  - Base (0): Blue
  - 40: Green
  - 60: Yellow
  - 80: Orange
  - 95: Red

### Przykład 3: Zużycie pamięci RAM

```PromQL
# Zapytanie
(1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100
```

**Konfiguracja**:
- **Calculation**: Last (not null)
- **Unit**: `percent (0-100)`
- **Min**: 0, **Max**: 100
- **Decimals**: 1
- **Orientation**: Horizontal
- **Thresholds**:
  - Base (0): Green
  - 75: Yellow
  - 90: Orange
  - 98: Red

### Przykład 4: Zapełnienie dysku

```PromQL
# Zapytanie
(node_filesystem_size_bytes{mountpoint="/"} - node_filesystem_avail_bytes{mountpoint="/"}) / node_filesystem_size_bytes{mountpoint="/"} * 100
```

**Konfiguracja**:
- **Calculation**: Last (not null)
- **Unit**: `percent (0-100)`
- **Min**: 0, **Max**: 100
- **Decimals**: 1
- **Orientation**: Vertical
- **Thresholds**:
  - Base (0): Green
  - 80: Yellow
  - 90: Orange
  - 95: Red

### Przykład 5: SLA / Uptime

```PromQL
# Zapytanie
avg_over_time(up{job="api-service"}[30d]) * 100
```

**Konfiguracja**:
- **Calculation**: Last (not null)
- **Unit**: `percent (0-100)`
- **Min**: 0, **Max**: 100
- **Decimals**: 2
- **Orientation**: Horizontal
- **Thresholds**:
  - Base (0): Red (< 90% - niedopuszczalne)
  - 90: Orange (90-95% - poniżej celu)
  - 95: Yellow (95-99% - akceptowalne)
  - 99: Green (99%+ - cel osiągnięty)
- **Value mappings**:
  - 99-100 → "SLA Met"
  - 95-99 → "Below Target"
  - 0-95 → "Critical"

### Przykład 6: Obroty wentylatora

```PromQL
# Zapytanie
node_hwmon_fan_rpm{chip="nct6775-isa-0a20",sensor="fan1"}
```

**Konfiguracja**:
- **Calculation**: Last (not null)
- **Unit**: `rpm`
- **Min**: 0, **Max**: 3000
- **Decimals**: 0
- **Orientation**: Horizontal
- **Thresholds**:
  - Base (0): Red (wentylator nie działa)
  - 500: Orange (wolno)
  - 1000: Yellow (normalna prędkość)
  - 1500: Green (optymalna prędkość)

## Najlepsze praktyki

### Kiedy używać Gauge

**Użyj Gauge gdy**:
```yaml
✓ Metryka ma określony zakres (0-100%, 0-max)
✓ Wizualny "wskaźnik zapełnienia" jest intuicyjny
✓ Wartość jest w miarę stabilna (nie zmienia się co sekundę)
✓ Progi kolorystyczne mają znaczenie biznesowe
✓ Użytkownik musi szybko ocenić "jak daleko do limitu"
✓ Panel jest średniego rozmiaru (nie za mały)
```

**NIE używaj Gauge gdy**:
```yaml
✗ Metryka nie ma górnej granicy (count bez max)
✗ Panel jest bardzo mały (użyj Stat)
✗ Potrzebujesz pokazać trend (użyj Stat z sparkline)
✗ Metryka zmienia się bardzo dynamicznie (użyj Time series)
✗ Masz wiele wartości do porównania (użyj Bar chart)
```

### Gauge vs Stat vs Bar gauge

**Gauge**:
- Analogowy wygląd (tradycyjny wskaźnik)
- Idealny dla pojedynczej wartości
- Wymaga więcej miejsca na dashboardzie
- Najlepszy dla stabilnych metryk zasobów

**Stat**:
- Minimalistyczny, zajmuje mało miejsca
- Może pokazać trend (sparkline)
- Lepszy dla dynamicznych wartości
- Dobry dla wielu paneli obok siebie

**Bar gauge**:
- Prosty pasek postępu
- Zajmuje najmniej miejsca
- Dobry dla wielu wartości (stack)
- Lepszy dla list metryk

### Konfiguracja progów

**Zasada 4-5 progów** dla optymalnej czytelności:
```yaml
# CPU/RAM/Disk:
Green (0-70%): OK, normalne wykorzystanie
Yellow (70-85%): Uwaga, zwiększone wykorzystanie
Orange (85-95%): Ostrzeżenie, wysokie wykorzystanie
Red (95-100%): Krytyczne, natychmiastowa akcja

# Temperatura:
Blue (0-30°C): Zimno
Green (30-60°C): Normalna temperatura
Yellow (60-80°C): Podwyższona temperatura
Orange (80-95°C): Wysoka temperatura
Red (95+°C): Krytyczna, ryzyko uszkodzenia
```

**NIE używaj zbyt wielu progów** (>6):
- Gauge staje się nieczytelny
- Trudno odróżnić kolory obok siebie
- Dezorientuje użytkownika

### Rozmiar i układ paneli

**Szerokość**: Gauge potrzebuje więcej miejsca niż Stat
```yaml
# Zalecana szerokość: 
# - Pojedynczy gauge: 3-4 grid units (25-33% szerokości)
# - W rzędzie 3-4 gauge: każdy po 3 units
# - W rzędzie 2 gauge: każdy po 6 units

# Minimalna szerokość: 2 units (ale nieczytelne)
# Maksymalna szerokość: 6 units (powyżej jest marnowanie miejsca)
```

**Wysokość**: Zazwyczaj proporcjonalna do szerokości
```yaml
# Wysokość: 150-250px
# Zbyt niski gauge (< 100px): nieczytelny
# Zbyt wysoki gauge (> 300px): marnowanie miejsca
```

**Układ na dashboardzie**:
```yaml
# Top row z kluczowymi gauges:
[CPU %] [Memory %] [Disk %] [Network %]

# Grouped by server:
Server 1: [CPU] [RAM]
Server 2: [CPU] [RAM]
Server 3: [CPU] [RAM]
```

### Jednostki i zakresy

**Procenty** (najczęstsze):
```yaml
Unit: percent (0-100)
Min: 0
Max: 100
Decimals: 0-1
```

**Temperatura**:
```yaml
Unit: celsius (°C) lub fahrenheit (°F)
Min: 0 lub -50 (dla zewnętrznej temperatury)
Max: 100 (CPU/system) lub 50 (ambient)
Decimals: 0
```

**Rozmiar danych** (disk space):
```yaml
# Opcja 1: Procenty
Unit: percent (0-100)
Min: 0
Max: 100

# Opcja 2: Bezwzględne wartości
Unit: bytes
Min: 0
Max: <disk_capacity> (np. 500GB = 500000000000)
Decimals: 0
```

**Prędkość obrotowa**:
```yaml
Unit: rpm (obr/min)
Min: 0
Max: <max_rpm> (np. 3000)
Decimals: 0
```

### Kolory progów

**Standardowy gradient** (Green → Yellow → Orange → Red):
```yaml
# Najczęściej używany dla metryk wykorzystania
# Intuicyjny dla większości użytkowników
# Green = OK, Red = Problem
```

**Odwrócony gradient** (Red → Orange → Yellow → Green):
```yaml
# Dla metryk "availability" lub "success rate"
# Gdzie niskie wartości są złe
# Przykład: SLA, uptime, success rate
```

**Temperature gradient** (Blue → Green → Yellow → Orange → Red):
```yaml
# Specyficzny dla temperatury
# Blue = bardzo zimno
# Green = optymalna temperatura
# Red = przegrzanie
```

## Rozwiązywanie problemów

**Gauge nie wyświetla wartości**:
1. Sprawdź zakres Min/Max - wartość może być poza zakresem
2. Calculation może zwracać null - użyj "Last (not null)"
3. Zweryfikuj zapytanie w Explore
4. Sprawdź Unit - może ukrywać wartość

**Kolory progów nie działają**:
1. Sprawdź Thresholds - muszą być poprawnie ustawione w zakresie Min-Max
2. Show threshold markers musi być "On"
3. Color scheme musi być "From thresholds"
4. Wartość może być poza zakresem progów

**Gauge jest za mały/nieczytelny**:
1. Zwiększ rozmiar panelu (min. 3x3 grid units)
2. Zwiększ Text size → Value
3. Zmniejsz liczbę progów (max 5)
4. Orientation → Horizontal (zazwyczaj lepiej czytelne)

**Wskazówka nie porusza się płynnie**:
1. To normalne - Gauge aktualizuje się co refresh interval
2. Zwiększ Auto refresh (5s, 10s)
3. Dla płynnych animacji rozważ Time series

**Za dużo miejsca wokół Gauge**:
1. Zwiększ Sizing → Manual
2. Ustaw Max width na mniejszą wartość
3. Zmniejsz wysokość panelu
4. Użyj Sizing → Auto i dostosuj rozmiar panelu

**Progi są niewidoczne**:
1. Show threshold markers → On
2. Show threshold labels → On (jeśli chcesz wartości)
3. Zwiększ kontrast kolorów między progami
4. Upewnij się że progi są w zakresie Min-Max
