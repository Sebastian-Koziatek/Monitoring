# Bar chart

Bar chart (wykres słupkowy) to wizualizacja przeznaczona do porównywania wartości między różnymi kategoriami. W odróżnieniu od Time series, wykres słupkowy koncentruje się na przedstawieniu danych kategorycznych, gdzie każdy słupek reprezentuje określoną grupę lub element.

## Charakterystyka wizualizacji

Wykres słupkowy przedstawia dane w formie prostokątnych słupków, gdzie:
- **Wysokość/długość słupka**: Reprezentuje wartość metryki
- **Oś kategorii**: Zawiera nazwy kategorii (hosty, usługi, regiony, etc.)
- **Oś wartości**: Wyświetla skalę mierzonych wartości
- **Grupowanie**: Możliwość wyświetlania wielu serii obok siebie lub jako stack

Najczęstsze zastosowania:
- Porównanie wykorzystania zasobów między serwerami
- Ranking najczęściej wykonywanych zapytań
- Zestawienie błędów według typu lub modułu
- Porównanie wydajności różnych środowisk (prod, stage, dev)
- Top N użytkowników według aktywności
- Rozkład requestów według endpoint'ów API

## Konfiguracja panelu

### Panel options

Standardowe opcje panelu (identyczne jak w Time series):
- **Title**: Tytuł wykresu
- **Description**: Szczegółowy opis
- **Transparent background**: Przezroczyste tło
- **Panel links**: Linki do powiązanych zasobów

### Orientation

Orientacja słupków na wykresie:

**Orientation**:
- **Auto**: Grafana automatycznie dobiera orientację
- **Horizontal**: Słupki poziome (dobre dla długich nazw kategorii)
- **Vertical**: Słupki pionowe (tradycyjny widok)

```yaml
# Użyj Horizontal gdy:
# - Nazwy kategorii są długie (nazwy hostów, URL'e)
# - Masz więcej niż 10 kategorii
# - Chcesz łatwiej czytać etykiety

# Użyj Vertical gdy:
# - Nazwy kategorii są krótkie
# - Masz mniej niż 10 kategorii
# - Wizualnie bardziej intuicyjne dla trendów wzrostowych
```

### Bar chart settings

**Show values**: Wyświetlanie wartości na słupkach
- **Auto**: Grafana decyduje na podstawie rozmiaru panelu
- **Always**: Zawsze wyświetlaj wartości
- **Never**: Nie wyświetlaj wartości

**Group width**: Szerokość grupy słupków (0.1 - 1.0)
- **0.9**: Słupki prawie się stykają (gęsto)
- **0.7**: Standardowa szerokość (domyślnie)
- **0.5**: Wąskie słupki z dużymi odstępami

**Bar width**: Szerokość pojedynczego słupka w grupie (0.1 - 1.0)

**Bar radius**: Zaokrąglenie rogów słupków (0 - 1.0)
- **0**: Ostre krawędzie (tradycyjny wygląd)
- **0.5**: Lekkie zaokrąglenie (nowoczesny wygląd)
- **1.0**: Maksymalne zaokrąglenie

### Stacking

Określa sposób układania wielu serii danych:

**Stack series**:
- **Off**: Słupki obok siebie dla każdej serii (domyślnie)
- **Normal**: Słupki układają się jeden na drugim, pokazując sumę
- **100%**: Słupki wypełniają wykres do 100%, pokazując proporcje

```PromQL
# Przykład stack dla statusów HTTP:
sum by (status) (rate(http_requests_total[5m]))

# Off: Osobne słupki dla 200, 404, 500
# Normal: Wysokość pokazuje łączną liczbę requestów
# 100%: Proporcje statusów w całym ruchu
```

### Axis

Konfiguracja osi wykresu:

**Placement**:
- **Auto**: Automatyczny dobór
- **Left**: Oś wartości po lewej
- **Right**: Oś wartości po prawej
- **Bottom**: Oś wartości na dole (dla horizontal)
- **Top**: Oś wartości na górze (dla horizontal)
- **Hidden**: Ukryj oś wartości

**Label**: Etykieta osi wartości
```
Przykład: "Liczba requestów/min" lub "Wykorzystanie pamięci [MB]"
```

**Scale**:
- **Linear**: Skala liniowa (domyślnie)
- **Logarithmic**: Skala logarytmiczna (gdy wartości różnią się rzędami wielkości)

**Soft min/max**: Sugerowane granice osi

### Legend

**Visibility**:
- **Auto**: Automatyczne wyświetlanie
- **Show**: Zawsze pokazuj
- **Hide**: Ukryj legendę

**Mode**:
- **List**: Lista serii
- **Table**: Tabela z dodatkowymi statystykami

**Placement**:
- **Bottom**: Pod wykresem (domyślnie)
- **Right**: Po prawej stronie
- **Top**: Nad wykresem

**Values**: Dodatkowe wartości w legendzie
- **Last**: Ostatnia wartość
- **Min**: Minimum
- **Max**: Maksimum
- **Mean**: Średnia
- **Total**: Suma

### Tooltip

**Mode**:
- **Single**: Informacje o jednym słupku
- **All**: Informacje o wszystkich seriach dla danej kategorii
- **Hidden**: Wyłącz tooltip

**Sort order**:
- **None**: Bez sortowania
- **Ascending**: Od najmniejszej wartości
- **Descending**: Od największej wartości

### Standard options

**Unit**: Jednostka miary
```yaml
# Popularne jednostki dla bar chart:
# - short: Liczby bez jednostki
# - percent (0-100): Procenty
# - bytes: Bajty z automatyczną konwersją
# - requests/sec: Żądania na sekundę
# - ms: Milisekundy
# - none: Bez jednostki (dla count)
```

**Min/Max**: Sztywne granice osi wartości

**Decimals**: Miejsca po przecinku
- **0**: Liczby całkowite (dla count'ów)
- **2**: Standardowa precyzja

**Display name**: Zmiana nazwy kategorii
```
Przykład: ${__field.labels.hostname} → ${__field.labels.hostname:text}
```

**Color scheme**:
- **Single color**: Jeden kolor dla wszystkich słupków
- **Classic palette**: Różne kolory dla każdej serii
- **Green-Yellow-Red**: Gradient dla progów
- **By value**: Kolor zależny od wartości

### Thresholds

Progi kolorystyczne dla słupków:

**Mode**:
- **Absolute**: Stałe wartości
- **Percentage**: Procenty względem zakresu

```yaml
# Przykład dla response time:
# 0ms: Green (szybko)
# 200ms: Yellow (akceptowalne)
# 500ms: Orange (wolno)
# 1000ms: Red (krytycznie wolno)
```

**Show thresholds**: Sposób wyświetlania progów
- **As filled regions**: Kolorowe tło za słupkami
- **As lines**: Linie progowe
- **Off**: Tylko kolor słupków

### Text size

Rozmiar tekstu na wykresie:

**Title**: Rozmiar tytułu (domyślnie: auto)
**Value**: Rozmiar wartości na słupkach (domyślnie: auto)

### Data links

Linki do innych dashboardów lub zewnętrzych zasobów, aktywowane po kliknięciu w słupek.

## Przykłady zastosowania

### Przykład 1: Top 10 serwerów według CPU

```PromQL
# Zapytanie
topk(10, 100 - (avg by(instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100))
```

**Konfiguracja**:
- **Orientation**: Horizontal
- **Unit**: `percent (0-100)`
- **Show values**: Always
- **Color scheme**: Green-Yellow-Red
- **Thresholds**: 0 (green), 70 (yellow), 85 (red)
- **Legend**: Hide (nazwy na osi Y)

### Przykład 2: Liczba requestów według endpoint'ów

```PromQL
# Zapytanie
topk(15, sum by (endpoint) (rate(http_requests_total[5m])))
```

**Konfiguracja**:
- **Orientation**: Horizontal
- **Unit**: `requests/sec`
- **Show values**: Always
- **Sort**: Descending (największe na górze)
- **Bar radius**: 0.3 (zaokrąglone rogi)
- **Legend**: Hide

### Przykład 3: Stack - błędy według typu i severity

```PromQL
# Zapytanie A - Errors
sum by (error_type) (rate(app_errors_total{severity="error"}[5m]))

# Zapytanie B - Warnings
sum by (error_type) (rate(app_errors_total{severity="warning"}[5m]))
```

**Konfiguracja**:
- **Orientation**: Vertical
- **Stack**: Normal
- **Unit**: `errors/sec`
- **Show values**: Always
- **Color scheme**: 
  - Errors → Red
  - Warnings → Orange
- **Legend**: Show (bottom, table mode)

### Przykład 4: Porównanie środowisk

```PromQL
# Zapytanie A - Production
avg(rate(http_request_duration_seconds_sum{env="prod"}[5m]) / rate(http_request_duration_seconds_count{env="prod"}[5m]))

# Zapytanie B - Staging  
avg(rate(http_request_duration_seconds_sum{env="staging"}[5m]) / rate(http_request_duration_seconds_count{env="staging"}[5m]))

# Zapytanie C - Development
avg(rate(http_request_duration_seconds_sum{env="dev"}[5m]) / rate(http_request_duration_seconds_count{env="dev"}[5m]))
```

**Konfiguracja**:
- **Orientation**: Vertical
- **Unit**: `milliseconds (ms)`
- **Group width**: 0.7
- **Bar width**: 0.8
- **Show values**: Always
- **Legend**: Show (bottom)
- **Thresholds**: 0 (green), 200 (yellow), 500 (red)

### Przykład 5: Wykorzystanie baz danych (MySQL)

```sql
-- Zapytanie SQL
SELECT 
  table_schema as "Database",
  ROUND(SUM(data_length + index_length) / 1024 / 1024, 2) as "Size MB"
FROM information_schema.tables
WHERE table_schema NOT IN ('information_schema', 'performance_schema', 'mysql', 'sys')
GROUP BY table_schema
ORDER BY SUM(data_length + index_length) DESC
LIMIT 20;
```

**Konfiguracja**:
- **Orientation**: Horizontal
- **Unit**: `megabytes (MB)`
- **Show values**: Always
- **X-axis**: Size MB
- **Y-axis**: Database names
- **Color**: Single color (blue)
- **Bar radius**: 0

## Najlepsze praktyki

### Wybór orientacji

**Horizontal** gdy:
```yaml
- Długie nazwy kategorii (hostname, URL, error messages)
- Więcej niż 10 kategorii
- Ranking lub Top N
- Łatwiejsze czytanie etykiet
```

**Vertical** gdy:
```yaml
- Krótkie nazwy kategorii (status codes, environment names)
- Mniej niż 10 kategorii
- Porównanie grup (grouped bar chart)
- Wizualnie podobne do Time series
```

### Ograniczanie liczby słupków

Bar chart staje się nieczytelny przy zbyt wielu kategoriach:

```PromQL
# Źle - zbyt wiele kategorii
sum by (instance) (node_memory_used_bytes)

# Dobrze - Top 10
topk(10, sum by (instance) (node_memory_used_bytes))

# Dobrze - Bottom 10 (najmniej obciążone)
bottomk(10, sum by (instance) (node_cpu_usage))
```

**Zalecenia**:
- **Vertical orientation**: maksymalnie 15 słupków
- **Horizontal orientation**: maksymalnie 30 słupków
- Użyj `topk()` lub `bottomk()` do ograniczenia wyników

### Sortowanie danych

Zawsze sortuj dane dla lepszej czytelności:

```PromQL
# W PromQL używaj sort() lub sort_desc()
sort_desc(sum by (endpoint) (rate(http_requests_total[5m])))

# W SQL używaj ORDER BY
SELECT category, value FROM table ORDER BY value DESC LIMIT 20
```

### Kolory i progi

**Dla jednej serii**:
- Użyj progów (thresholds) do kolorowania według wartości
- Gradient Green-Yellow-Red dla metryk wydajnościowych

**Dla wielu serii**:
- Użyj Classic palette dla rozróżnienia serii
- Zachowaj spójność kolorów (prod=red, staging=orange, dev=blue)

### Stack vs Grouped

**Stack (Normal)** gdy:
```yaml
- Chcesz pokazać sumę wszystkich komponentów
- Interesuje Cię całkowita wartość
- Przykład: Suma requestów według statusu HTTP
```

**Grouped (Off)** gdy:
```yaml
- Chcesz porównać wartości między kategoriami
- Każda seria jest niezależna
- Przykład: Response time dla różnych środowisk
```

**Stack (100%)** gdy:
```yaml
- Chcesz pokazać proporcje/udział procentowy
- Całość zawsze wynosi 100%
- Przykład: Rozkład typów błędów w całym ruchu
```

### Wartości na słupkach

**Show values = Always** gdy:
```yaml
- Dokładne wartości są ważne
- Użytkownicy będą cytować liczby
- Panel jest duży (dużo miejsca)
- Mało słupków (< 20)
```

**Show values = Never** gdy:
```yaml
- Trend jest ważniejszy niż dokładne wartości
- Dużo słupków (> 30)
- Panel jest mały
- Wartości są w legendzie (table mode)
```

## Rozwiązywanie problemów

**Słupki są niewidoczne**:
1. Sprawdź Min/Max na osi - mogą przycinać wartości
2. Zwiększ Group width i Bar width
3. Sprawdź czy dane nie są zerowe w wybranym czasie

**Nieczytelne etykiety**:
1. Zmień orientation na Horizontal
2. Ogranicz liczbę kategorii (topk/bottomk)
3. Użyj skróconych nazw w Display name
4. Zwiększ rozmiar panelu

**Zbyt wiele kategorii**:
1. Użyj `topk(N, ...)` lub `bottomk(N, ...)`
2. Dodaj filtering w zapytaniu
3. Rozważ użycie Table zamiast Bar chart
4. Podziel na wiele paneli (np. Top 10 + Others)

**Kolory nie działają**:
1. Sprawdź Thresholds - muszą być włączone
2. Upewnij się że Color scheme = "By value" lub "Green-Yellow-Red"
3. Dla wielu serii użyj Classic palette zamiast progów

**Stack nie działa poprawnie**:
1. Upewnij się że serie mają te same labels (poza grouping)
2. Sprawdź czy zapytania zwracają dane dla tego samego czasu
3. Użyj tej samej funkcji agregacji dla wszystkich serii
