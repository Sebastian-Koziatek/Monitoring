## Wprowadzenie

Grafana OSS jest dostępna w różnych wariantach instalacji, co pozwala na elastyczne dopasowanie do środowiska produkcyjnego. Niniejszy dokument opisuje instalację na Ubuntu 24.04 LTS oraz uruchomienie w kontenerze Docker. Oba podejścia mają zastosowanie w środowiskach produkcyjnych, przy czym instalacja natywna oferuje lepszą integrację z systemem operacyjnym, a konteneryzacja zapewnia izolację i łatwość zarządzania w architekturach cloud-native.

---

## Instalacja na Ubuntu 24.04 LTS

### Wymagania systemowe

**Minimalne wymagania:**
- CPU: 1 vCPU
- RAM: 512 MB
- Dysk: 1 GB (bez danych metryk)
- System: Ubuntu 24.04 LTS (x86_64 lub ARM64)

**Zalecane wymagania dla środowisk produkcyjnych:**
- CPU: 2+ vCPU
- RAM: 2+ GB (4-8 GB dla dużych instalacji)
- Dysk: 10+ GB (zależnie od liczby dashboardów i użytkowników)
- System: Ubuntu 24.04 LTS z aktualizacjami bezpieczeństwa

**Dodatkowe zależności:**
- Grafana wymaga dostępu do portów: 3000 (HTTP UI), opcjonalnie 443 (HTTPS)
- Dostęp sieciowy do zewnętrznych datasources (Prometheus, Loki, bazy danych)
- libfontconfig1 dla renderowania obrazów (snapshoty, PDF reports w Enterprise)

### Metoda 1: Instalacja z oficjalnego repozytorium APT (zalecana)

Instalacja z oficjalnego repozytorium Grafana Labs zapewnia automatyczne aktualizacje poprzez `apt upgrade` i spójność z ekosystemem Ubuntu.

#### Krok 1: Instalacja wymaganych pakietów

```bash
sudo apt-get update
sudo apt-get install -y apt-transport-https software-properties-common wget
```

**Wyjaśnienie:**
- `apt-transport-https` – umożliwia apt pobieranie pakietów przez HTTPS
- `software-properties-common` – narzędzia do zarządzania repozytoriami
- `wget` – narzędzie do pobierania plików (użyte do klucza GPG)

#### Krok 2: Dodanie klucza GPG repozytorium Grafana

```bash
sudo mkdir -p /etc/apt/keyrings/
wget -q -O - https://apt.grafana.com/gpg.key | gpg --dearmor | sudo tee /etc/apt/keyrings/grafana.gpg > /dev/null
```

**Wyjaśnienie:**
Klucz GPG służy do weryfikacji autentyczności pakietów. Przechowywanie w `/etc/apt/keyrings/` jest zgodne z najlepszymi praktykami Ubuntu 24.04.

#### Krok 3: Dodanie repozytorium Grafana OSS (stable)

```bash
echo "deb [signed-by=/etc/apt/keyrings/grafana.gpg] https://apt.grafana.com stable main" | sudo tee /etc/apt/sources.list.d/grafana.list
```

**Kanały dystrybucji:**
- `stable` – stabilne wydania produkcyjne (zalecane)
- `beta` – wersje beta z nowymi funkcjami (testowe)

#### Krok 4: Aktualizacja indeksu pakietów i instalacja Grafany

```bash
sudo apt-get update
sudo apt-get install -y grafana
```

To polecenie instaluje:
- Binaria Grafany w `/usr/share/grafana/`
- Pliki konfiguracyjne w `/etc/grafana/`
- Dane i logi w `/var/lib/grafana/` i `/var/log/grafana/`
- Usługę systemd `grafana-server.service`

#### Krok 5: Włączenie i uruchomienie usługi Grafana

```bash
sudo systemctl daemon-reload
sudo systemctl enable grafana-server
sudo systemctl start grafana-server
```

**Wyjaśnienie:**
- `daemon-reload` – przeładowanie konfiguracji systemd
- `enable` – uruchomienie Grafany przy starcie systemu
- `start` – natychmiastowe uruchomienie usługi

#### Krok 6: Weryfikacja statusu usługi

```bash
sudo systemctl status grafana-server
```

**Oczekiwany output:**
```
● grafana-server.service - Grafana instance
     Loaded: loaded (/lib/systemd/system/grafana-server.service; enabled; preset: enabled)
     Active: active (running) since Thu 2026-01-30 10:00:00 UTC; 5s ago
       Docs: http://docs.grafana.org
   Main PID: 12345 (grafana)
      Tasks: 15 (limit: 4915)
     Memory: 45.2M
        CPU: 2.345s
     CGroup: /system.slice/grafana-server.service
             └─12345 /usr/share/grafana/bin/grafana server --config=/etc/grafana/grafana.ini
```

Status `active (running)` potwierdza poprawne uruchomienie.

#### Krok 7: Weryfikacja dostępu do interfejsu webowego

```bash
curl -I http://localhost:3000
```

**Oczekiwany output:**
```
HTTP/1.1 302 Found
Location: /login
```

Alternatywnie, otwórz przeglądarkę i przejdź do:
```
http://<IP_SERWERA>:3000
```

**Domyślne dane logowania:**
- Użytkownik: `admin`
- Hasło: `admin`

**UWAGA BEZPIECZEŃSTWA:** Przy pierwszym logowaniu Grafana wymusi zmianę hasła. W środowiskach produkcyjnych należy natychmiast zmienić domyślne hasło i skonfigurować silne uwierzytelnianie (LDAP, OAuth, SAML).

---

### Podstawowa konfiguracja Grafana

Główny plik konfiguracyjny Grafany znajduje się w:
```
/etc/grafana/grafana.ini
```

#### Kluczowe sekcje konfiguracji

**1. Sekcja [server] – ustawienia serwera HTTP**

```ini
[server]
# Protokół (http, https, h2, socket)
protocol = http

# Adres IP do bindowania (0.0.0.0 = wszystkie interfejsy)
http_addr = 0.0.0.0

# Port HTTP
http_port = 3000

# Domena (ważne dla OAuth callbacks i linków w alertach)
domain = localhost

# Root URL (jeśli Grafana działa za reverse proxy)
root_url = %(protocol)s://%(domain)s:%(http_port)s/

# Włączenie HTTPS (wymaga certyfikatu)
;cert_file = /path/to/cert.pem
;cert_key = /path/to/key.pem
```

**Konsekwencje konfiguracji:**
- `http_addr = 0.0.0.0` – Grafana będzie dostępna ze wszystkich interfejsów sieciowych. W środowiskach produkcyjnych rozważ bindowanie tylko do interfejsu wewnętrznego i użycie reverse proxy (nginx, Traefik).
- `root_url` – kluczowe dla poprawnego działania OAuth, webhooków i linków w emailach z alertami.

**2. Sekcja [database] – backend bazodanowy**

Domyślnie Grafana używa SQLite3, co jest wystarczające dla małych instalacji (do ~100 użytkowników, ~1000 dashboardów).

```ini
[database]
# Typ bazy: sqlite3, mysql, postgres
type = sqlite3

# Ścieżka do pliku SQLite
path = grafana.db
```

**Migracja do PostgreSQL (zalecane dla produkcji):**

```ini
[database]
type = postgres
host = 127.0.0.1:5432
name = grafana
user = grafana
password = <SECURE_PASSWORD>

# Connection pool settings
max_idle_conn = 2
max_open_conn = 10
conn_max_lifetime = 14400
```

**Konsekwencje:**
- SQLite3 – prostsza instalacja, brak zewnętrznych zależności, ale ograniczenia wydajnościowe przy dużym obciążeniu.
- PostgreSQL/MySQL – wymagana osobna baza danych, ale lepsza wydajność, wsparcie dla HA i backup'ów.

**3. Sekcja [security] – bezpieczeństwo**

```ini
[security]
# Admin user (utworzony przy pierwszym uruchomieniu)
admin_user = admin
admin_password = <CHANGE_ME>

# Secret key (używany do szyfrowania secrets w bazie)
# MUSI być unikalny dla każdej instalacji
secret_key = <GENERATE_RANDOM_STRING>

# Wyłączenie tworzenia kont przez użytkowników
disable_gravatar = true
```

**Generowanie secret_key:**
```bash
openssl rand -base64 32
```

**KRYTYCZNE:** Nigdy nie używaj domyślnych wartości `secret_key` w produkcji. Zmiana secret_key po zapisaniu secretów (hasła datasources) uniemożliwi ich odczyt.

**4. Sekcja [users] – zarządzanie użytkownikami**

```ini
[users]
# Zezwalaj na rejestrację nowych użytkowników (wyłącz w produkcji)
allow_sign_up = false

# Domyślna rola dla nowych użytkowników
auto_assign_org_role = Viewer

# Domyślna organizacja
default_org_id = 1
```

**5. Sekcja [auth] – uwierzytelnianie**

```ini
[auth]
# Wyłączenie logowania anonimowego
disable_login_form = false

[auth.anonymous]
# Dostęp anonimowy (NIGDY w produkcji)
enabled = false
```

**6. Sekcja [smtp] – powiadomienia email**

```ini
[smtp]
enabled = true
host = smtp.example.com:587
user = grafana@example.com
password = <SMTP_PASSWORD>
from_address = grafana@example.com
from_name = Grafana
startTLS_policy = MandatoryStartTLS
```

Wymagane do wysyłania alertów emailowych i zaproszeń użytkowników.

**7. Sekcja [log] – logowanie**

```ini
[log]
# Poziom logowania: debug, info, warn, error, critical
level = info

# Miejsce logów: console, file, syslog
mode = console file

[log.file]
# Ścieżka do pliku logów
log_rotate = true
max_lines = 1000000
max_size_shift = 28
daily_rotate = true
max_days = 7
```

Logi znajdują się w `/var/log/grafana/grafana.log`.

#### Zastosowanie zmian konfiguracyjnych

Po edycji `grafana.ini`:

```bash
sudo systemctl restart grafana-server
sudo systemctl status grafana-server
```

**Weryfikacja błędów konfiguracji:**
```bash
sudo journalctl -u grafana-server -f
```

---

### Zarządzanie usługą Grafana (systemd)

**Sprawdzenie statusu:**
```bash
sudo systemctl status grafana-server
```

**Uruchomienie:**
```bash
sudo systemctl start grafana-server
```

**Zatrzymanie:**
```bash
sudo systemctl stop grafana-server
```

**Restart:**
```bash
sudo systemctl restart grafana-server
```

**Wyłączenie autostartu:**
```bash
sudo systemctl disable grafana-server
```

**Podgląd logów:**
```bash
sudo journalctl -u grafana-server -n 100 --no-pager
```

**Tail logów (śledzenie na żywo):**
```bash
sudo journalctl -u grafana-server -f
```

---

### Struktura katalogów Grafana na Ubuntu

| Ścieżka | Opis | Właściciel |
|---|---|---|
| `/usr/share/grafana/` | Binaria i pliki aplikacji | root:root |
| `/etc/grafana/` | Pliki konfiguracyjne | root:grafana |
| `/etc/grafana/grafana.ini` | Główny plik konfiguracyjny | root:grafana |
| `/etc/grafana/provisioning/` | Provisioning (datasources, dashboards, alerting) | root:grafana |
| `/var/lib/grafana/` | Baza danych, sesje, pluginy | grafana:grafana |
| `/var/lib/grafana/grafana.db` | SQLite database (jeśli używane) | grafana:grafana |
| `/var/lib/grafana/plugins/` | Zainstalowane pluginy | grafana:grafana |
| `/var/log/grafana/` | Pliki logów | grafana:grafana |
| `/var/log/grafana/grafana.log` | Główny plik logów | grafana:grafana |

**Uprawnienia:**
Wszystkie katalogi i pliki w `/var/lib/grafana/` i `/var/log/grafana/` muszą być własnością użytkownika `grafana:grafana`. Nieprawidłowe uprawnienia to częsta przyczyna błędów.

**Weryfikacja uprawnień:**
```bash
sudo ls -la /var/lib/grafana/
sudo ls -la /var/log/grafana/
```

---

### Aktualizacja Grafana OSS

Ponieważ Grafana została zainstalowana z repozytorium APT, aktualizacja odbywa się standardowo:

```bash
sudo apt-get update
sudo apt-get upgrade grafana
```

**Najlepsze praktyki aktualizacji:**

1. **Backup bazy danych przed aktualizacją:**
```bash
# SQLite
sudo cp /var/lib/grafana/grafana.db /var/lib/grafana/grafana.db.backup

# PostgreSQL
pg_dump -U grafana grafana > grafana_backup_$(date +%Y%m%d).sql
```

2. **Sprawdź release notes:**
```
https://grafana.com/docs/grafana/latest/whatsnew/
```

3. **Testuj aktualizacje w środowisku testowym.**

4. **Po aktualizacji zweryfikuj działanie:**
```bash
sudo systemctl status grafana-server
curl -I http://localhost:3000
```

---

### Odinstalowanie Grafana

```bash
# Zatrzymanie i wyłączenie usługi
sudo systemctl stop grafana-server
sudo systemctl disable grafana-server

# Usunięcie pakietu
sudo apt-get remove grafana

# Usunięcie pakietu wraz z konfiguracją i danymi
sudo apt-get purge grafana

# Usunięcie repozytorium
sudo rm /etc/apt/sources.list.d/grafana.list
sudo rm /etc/apt/keyrings/grafana.gpg

# Czyszczenie danych (opcjonalnie)
sudo rm -rf /var/lib/grafana
sudo rm -rf /var/log/grafana
sudo rm -rf /etc/grafana
```

---

## Instalacja Grafana w Docker

Konteneryzacja Grafany oferuje izolację, łatwość wdrażania i spójność między środowiskami (development, staging, production). Jest to zalecane podejście dla architektur cloud-native i Kubernetes.

### Wymagania

- Docker Engine 20.10+ lub Docker Desktop
- Docker Compose 2.0+ (opcjonalnie, dla orkiestracji)
- 2 GB RAM dostępnego dla kontenera
- Wolumen do persystencji danych

### Metoda 1: Docker run (quickstart)

#### Podstawowe uruchomienie (bez persystencji)

```bash
docker run -d \
  --name=grafana \
  -p 3000:3000 \
  grafana/grafana-oss:latest
```

**Wyjaśnienie parametrów:**
- `-d` – uruchomienie w tle (detached mode)
- `--name=grafana` – nazwa kontenera
- `-p 3000:3000` – mapowanie portu host:container
- `grafana/grafana-oss:latest` – oficjalny obraz Grafana OSS

**UWAGA:** Dane w tym trybie są efemeryczne – restart kontenera usuwa wszystkie dashboardy, datasources i użytkowników.

#### Uruchomienie z persystencją danych

```bash
docker run -d \
  --name=grafana \
  -p 3000:3000 \
  -v grafana-storage:/var/lib/grafana \
  grafana/grafana-oss:11.4.0
```

**Wyjaśnienie:**
- `-v grafana-storage:/var/lib/grafana` – named volume dla persystencji bazy danych, pluginów i sesji
- `11.4.0` – użycie konkretnej wersji zamiast `latest` (zalecane w produkcji dla reproducibility)

**Weryfikacja wolumenu:**
```bash
docker volume ls
docker volume inspect grafana-storage
```

#### Uruchomienie z custom configuration

```bash
docker run -d \
  --name=grafana \
  -p 3000:3000 \
  -v grafana-storage:/var/lib/grafana \
  -v /path/to/grafana.ini:/etc/grafana/grafana.ini \
  -e "GF_SERVER_ROOT_URL=http://grafana.example.com" \
  -e "GF_SECURITY_ADMIN_PASSWORD=SecurePassword123" \
  grafana/grafana-oss:11.4.0
```

**Wyjaśnienie:**
- `-v /path/to/grafana.ini:/etc/grafana/grafana.ini` – montowanie custom konfiguracji
- `-e "GF_*"` – zmienne środowiskowe nadpisujące `grafana.ini`

**Zmienne środowiskowe:**
Wszystkie ustawienia z `grafana.ini` mogą być nadpisane zmiennymi środowiskowymi w formacie:
```
GF_<SECTION_NAME>_<KEY_NAME>
```

Przykłady:
```bash
GF_SERVER_HTTP_PORT=3000
GF_DATABASE_TYPE=postgres
GF_DATABASE_HOST=postgres:5432
GF_SECURITY_ADMIN_USER=admin
GF_SECURITY_ADMIN_PASSWORD=SecurePassword
GF_AUTH_ANONYMOUS_ENABLED=false
```

#### Dostęp do kontenera

```bash
# Logowanie do shella kontenera
docker exec -it grafana bash

# Podgląd logów
docker logs grafana

# Tail logów
docker logs -f grafana

# Status kontenera
docker ps | grep grafana
```

---

### Metoda 2: Docker Compose (zalecana dla production)

Docker Compose umożliwia deklaratywną definicję całego stacku (Grafana + datasources) w jednym pliku.

#### Przykład 1: Standalone Grafana z PostgreSQL

Utwórz katalog projektu:
```bash
mkdir -p ~/grafana-stack
cd ~/grafana-stack
```

Utwórz plik `docker-compose.yml`:

```yaml
version: '3.8'

services:
  grafana:
    image: grafana/grafana-oss:11.4.0
    container_name: grafana
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      # Admin credentials
      - GF_SECURITY_ADMIN_USER=admin
      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_ADMIN_PASSWORD:-admin}
      
      # Database configuration
      - GF_DATABASE_TYPE=postgres
      - GF_DATABASE_HOST=postgres:5432
      - GF_DATABASE_NAME=grafana
      - GF_DATABASE_USER=grafana
      - GF_DATABASE_PASSWORD=${POSTGRES_PASSWORD}
      - GF_DATABASE_SSL_MODE=disable
      
      # Server settings
      - GF_SERVER_DOMAIN=${GRAFANA_DOMAIN:-localhost}
      - GF_SERVER_ROOT_URL=http://${GRAFANA_DOMAIN:-localhost}:3000
      
      # Security
      - GF_SECURITY_SECRET_KEY=${GRAFANA_SECRET_KEY}
      - GF_USERS_ALLOW_SIGN_UP=false
      
      # SMTP (optional)
      - GF_SMTP_ENABLED=true
      - GF_SMTP_HOST=${SMTP_HOST}
      - GF_SMTP_USER=${SMTP_USER}
      - GF_SMTP_PASSWORD=${SMTP_PASSWORD}
      - GF_SMTP_FROM_ADDRESS=${SMTP_FROM}
    
    volumes:
      - grafana-data:/var/lib/grafana
      - ./grafana/provisioning:/etc/grafana/provisioning
    
    networks:
      - monitoring
    
    depends_on:
      - postgres
    
    healthcheck:
      test: ["CMD-SHELL", "wget --no-verbose --tries=1 --spider http://localhost:3000/api/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  postgres:
    image: postgres:16-alpine
    container_name: grafana-postgres
    restart: unless-stopped
    environment:
      - POSTGRES_DB=grafana
      - POSTGRES_USER=grafana
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
    volumes:
      - postgres-data:/var/lib/postgresql/data
    networks:
      - monitoring
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U grafana"]
      interval: 10s
      timeout: 5s
      retries: 5

volumes:
  grafana-data:
    driver: local
  postgres-data:
    driver: local

networks:
  monitoring:
    driver: bridge
```

**Utwórz plik `.env`:**

```bash
# Grafana settings
GRAFANA_ADMIN_PASSWORD=SuperSecurePassword123
GRAFANA_SECRET_KEY=<generate-with-openssl-rand-base64-32>
GRAFANA_DOMAIN=localhost

# PostgreSQL
POSTGRES_PASSWORD=PostgresSecurePassword456

# SMTP (optional)
SMTP_HOST=smtp.example.com:587
SMTP_USER=grafana@example.com
SMTP_PASSWORD=SmtpPassword789
SMTP_FROM=grafana@example.com
```

**Generowanie secret key:**
```bash
openssl rand -base64 32
```

**Uruchomienie stacku:**

```bash
docker compose up -d
```

**Weryfikacja:**
```bash
docker compose ps
docker compose logs grafana
docker compose logs postgres
```

**Oczekiwany output `docker compose ps`:**
```
NAME                IMAGE                        STATUS
grafana             grafana/grafana-oss:11.4.0   Up (healthy)
grafana-postgres    postgres:16-alpine           Up (healthy)
```

**Dostęp do Grafany:**
```
http://localhost:3000
```

Login: `admin` / hasło z `.env` (`GRAFANA_ADMIN_PASSWORD`)

---

#### Przykład 2: Pełny stack observability (Grafana + Prometheus + Loki)

Utwórz `docker-compose.yml`:

```yaml
version: '3.8'

services:
  grafana:
    image: grafana/grafana-oss:11.4.0
    container_name: grafana
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_USER=admin
      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_ADMIN_PASSWORD}
      - GF_USERS_ALLOW_SIGN_UP=false
    volumes:
      - grafana-data:/var/lib/grafana
      - ./grafana/provisioning/datasources:/etc/grafana/provisioning/datasources
      - ./grafana/provisioning/dashboards:/etc/grafana/provisioning/dashboards
    networks:
      - monitoring

  prometheus:
    image: prom/prometheus:v2.48.1
    container_name: prometheus
    restart: unless-stopped
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--storage.tsdb.retention.time=30d'
      - '--web.enable-lifecycle'
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus-data:/prometheus
    networks:
      - monitoring

  loki:
    image: grafana/loki:2.9.3
    container_name: loki
    restart: unless-stopped
    command: -config.file=/etc/loki/local-config.yaml
    ports:
      - "3100:3100"
    volumes:
      - loki-data:/loki
    networks:
      - monitoring

  promtail:
    image: grafana/promtail:2.9.3
    container_name: promtail
    restart: unless-stopped
    volumes:
      - /var/log:/var/log:ro
      - ./promtail/promtail.yml:/etc/promtail/config.yml
    command: -config.file=/etc/promtail/config.yml
    networks:
      - monitoring

volumes:
  grafana-data:
  prometheus-data:
  loki-data:

networks:
  monitoring:
    driver: bridge
```

**Provisioning datasources:**

Utwórz `grafana/provisioning/datasources/datasources.yml`:

```yaml
apiVersion: 1

datasources:
  - name: Prometheus
    type: prometheus
    access: proxy
    url: http://prometheus:9090
    isDefault: true
    editable: false
    jsonData:
      timeInterval: 15s

  - name: Loki
    type: loki
    access: proxy
    url: http://loki:3100
    editable: false
```

**Uruchomienie pełnego stacku:**

```bash
docker compose up -d
```

**Weryfikacja:**
```bash
docker compose ps
curl http://localhost:3000/api/health
curl http://localhost:9090/-/healthy
curl http://localhost:3100/ready
```

---

### Zarządzanie kontenerami Grafana

**Restart:**
```bash
docker compose restart grafana
```

**Zatrzymanie:**
```bash
docker compose stop grafana
```

**Usunięcie (zachowanie wolumenów):**
```bash
docker compose down
```

**Usunięcie wraz z wolumenami (UWAGA: utrata danych):**
```bash
docker compose down -v
```

**Upgrade do nowej wersji:**

1. Edytuj `docker-compose.yml` i zmień wersję image:
```yaml
image: grafana/grafana-oss:11.5.0  # nowa wersja
```

2. Wykonaj pull nowego image:
```bash
docker compose pull grafana
```

3. Restart z nową wersją:
```bash
docker compose up -d grafana
```

**Backup wolumenu:**
```bash
docker run --rm \
  -v grafana-data:/data \
  -v $(pwd):/backup \
  alpine tar czf /backup/grafana-backup-$(date +%Y%m%d).tar.gz -C /data .
```

**Restore z backupu:**
```bash
docker run --rm \
  -v grafana-data:/data \
  -v $(pwd):/backup \
  alpine tar xzf /backup/grafana-backup-20260130.tar.gz -C /data
```

---

### Rozwiązywanie problemów (Troubleshooting)

#### Problem: Grafana nie startuje

**Diagnoza:**
```bash
# Sprawdź logi
docker logs grafana

# Sprawdź uprawnienia wolumenu
docker exec grafana ls -la /var/lib/grafana
```

**Typowe przyczyny:**
1. Błędne uprawnienia w wolumenie
2. Port 3000 zajęty
3. Błąd w konfiguracji (grafana.ini lub zmienne środowiskowe)

**Rozwiązanie uprawnień:**
```bash
docker exec grafana chown -R 472:472 /var/lib/grafana
```

User ID 472 to domyślny UID użytkownika `grafana` w kontenerze.

#### Problem: Brak dostępu do datasources

**Diagnoza:**
```bash
# Sprawdź connectivity z kontenera Grafana
docker exec grafana ping prometheus
docker exec grafana curl http://prometheus:9090/-/healthy
```

**Rozwiązanie:**
Upewnij się, że kontenery są w tej samej sieci Docker:
```bash
docker network ls
docker network inspect monitoring
```

#### Problem: Utrata danych po restarcie

**Diagnoza:**
Brak skonfigurowanego wolumenu – dane są efemeryczne.

**Rozwiązanie:**
Zawsze używaj named volumes lub bind mounts:
```bash
-v grafana-data:/var/lib/grafana
```

---

## Porównanie: Ubuntu vs Docker

| Aspekt | Instalacja na Ubuntu | Docker |
|---|---|---|
| **Instalacja** | Wymaga konfiguracji repo i systemd | `docker run` lub `docker compose up` |
| **Izolacja** | Współdzieli system z hostem | Pełna izolacja w kontenerze |
| **Wydajność** | Natywna (lepsza) | Niewielki overhead (kontener) |
| **Persystencja** | Automatyczna (dysk lokalny) | Wymaga konfiguracji wolumenów |
| **Aktualizacje** | `apt upgrade` | Zmiana tagu image i restart |
| **Backup** | Pliki w `/var/lib/grafana/` | Backup wolumenów Docker |
| **Integracja z systemem** | Pełna (systemd, logi, monitoring) | Ograniczona (wymaga konfiguracji) |
| **Użycie w Kubernetes** | Nie (wymaga konteneryzacji) | Tak (gotowe do K8s) |
| **Złożoność** | Średnia (wymaga znajomości Linux) | Niska (standardowy workflow Docker) |
| **Rekomendacja** | Dedykowane serwery, VM, bare metal | Cloud-native, mikrousługi, dev/test |

---

## Następne kroki

Po poprawnej instalacji Grafany:

1. **Zmień domyślne hasło admina**
2. **Skonfiguruj datasources** (Prometheus, Loki, bazy danych)
3. **Zaimportuj pierwsze dashboardy** z https://grafana.com/grafana/dashboards/
4. **Skonfiguruj SMTP** dla powiadomień emailowych
5. **Ustaw backup strategy** dla bazy danych Grafany
6. **Zaplanuj monitoring samej Grafany** (eksporter metryk, logi)
7. **Wdróż HTTPS** (nginx/Traefik jako reverse proxy z certyfikatami Let's Encrypt)

**Dokumentacja:**
- Oficjalna dokumentacja: https://grafana.com/docs/grafana/latest/
- Best practices: https://grafana.com/docs/grafana/latest/administration/
- Community dashboards: https://grafana.com/grafana/dashboards/


