# Stat

Stat to wizualizacja przeznaczona do wyświetlania pojedynczej, kluczowej wartości metryki w sposób czytelny i wyraźny. Jest to najbardziej podstawowa i często używana wizualizacja do prezentacji KPI (Key Performance Indicators) oraz ważnych metryk na dashboardach przeglądowych.

## Charakterystyka wizualizacji

Wizualizacja Stat wyświetla:
- **Główną wartość**: Duża, dobrze widoczna liczba
- **Trend**: Opcjonalny wykres sparkline pokazujący trend w czasie
- **Zmianę**: Opcjonalną zmianę wartości względem poprzedniego pomiaru
- **Kolor tła**: Dynamiczny, zależny od progów (thresholds)

Najczęstsze zastosowania:
- Wyświetlanie bieżącego wykorzystania zasobów (CPU %, RAM %, dysk %)
- Prezentacja liczby aktywnych użytkowników, sesji, połączeń
- Monitoring błędów i alertów (liczba aktywnych alertów)
- Czas odpowiedzi aplikacji (średni/p95)
- Metryki biznesowe (przychód, zamówienia, konwersja)
- Status systemu (uptime, liczba uruchomionych serwisów)

## Konfiguracja panelu

### Panel options

Standardowe opcje panelu:
- **Title**: Tytuł panelu (opcjonalnie można ukryć)
- **Description**: Dodatkowy opis widoczny po najechaniu
- **Transparent background**: Przezroczyste tło

```yaml
# Najlepsze praktyki:
# - Tytuł powinien jasno określać co pokazuje metryka
# - Użyj Description dla dodatkowego kontekstu
# Przykład: "CPU Usage" z opisem "Average across all production servers"
```

### Stat styles

Główne opcje wizualne panelu Stat:

**Graph mode**: Wyświetlanie wykresu trendu
- **None**: Tylko wartość, bez wykresu (domyślnie, najbardziej czytelne)
- **Area**: Wykres wypełniony pod linią trendu
- **Line**: Cienka linia trendu

```yaml
# None: Dla prostych KPI bez historii (liczba serwerów online)
# Area: Dla metryk ze znaczącą zmiennością (ruch sieciowy)
# Line: Dla subtelnego pokazania trendu bez dominacji wizualnej
```

**Color mode**: Sposób kolorowania panelu
- **Value**: Kolor tylko wartości (liczba)
- **Background solid**: Jednolity kolor tła całego panelu (najlepszy dla alertów)
- **Background gradient**: Gradient kolorystyczny tła
- **None**: Bez kolorowania (domyślny kolor tekstu)

```yaml
# Value: Standardowe użycie, kolor nie odwraca uwagi
# Background solid: Dla statusów i alertów (np. liczba błędów)
# Background gradient: Estetyczne, ale może utrudniać czytanie
# None: Gdy progi nie są używane
```

**Text mode**: Kontrola wielkości i wyświetlania wartości
- **Auto**: Grafana automatycznie dobiera rozmiar
- **Value**: Priorytet dla wartości (duża liczba)
- **Value and name**: Wartość i nazwa metryki
- **Name**: Tylko nazwa metryki
- **None**: Bez tekstu (tylko wykres trendu)

```yaml
# Auto/Value: Standardowe użycie dla KPI
# Value and name: Gdy tytuł panelu jest ukryty
# Name: Rzadko używane
# None: Tylko w specjalnych przypadkach z graph mode
```

**Orientation**: Układ elementów panelu
- **Auto**: Automatyczny dobór
- **Horizontal**: Wartość obok wykresu trendu
- **Vertical**: Wartość nad wykresem trendu

**Text alignment**: Wyrównanie tekstu
- **Auto**: Automatyczne centrowanie
- **Left**: Wyrównanie do lewej
- **Center**: Wyśrodkowanie
- **Right**: Wyrównanie do prawej

**Text size**: Rozmiar tekstu
- **Title**: Rozmiar tytułu panelu
- **Value**: Rozmiar głównej wartości (domyślnie: auto)

```yaml
# Zwiększ Value size dla kluczowych metryk na dużych ekranach
# Zmniejsz dla paneli z wieloma Stat obok siebie
```

### Calculation

Określa jaka wartość z serii czasowej jest wyświetlana:

**Calculation**:
- **Last (not null)**: Ostatnia niepusta wartość (domyślnie)
- **Last**: Ostatnia wartość, nawet jeśli null
- **First (not null)**: Pierwsza niepusta wartość w zakresie
- **First**: Pierwsza wartość w zakresie
- **Min**: Minimum z zakresu
- **Max**: Maksimum z zakresu
- **Mean**: Średnia arytmetyczna
- **Sum**: Suma wszystkich wartości
- **Count**: Liczba pomiarów
- **Range**: Różnica między max a min
- **Delta**: Różnica między ostatnią a pierwszą wartością
- **Step**: Przyrost wartości
- **Difference**: Różnica między wartościami
- **Change count**: Liczba zmian wartości
- **Distinct count**: Liczba unikalnych wartości

```PromQL
# Przykłady zastosowania:

# Last (not null) - bieżące wykorzystanie CPU
node_cpu_usage_percent

# Mean - średni czas odpowiedzi za ostatnie 5 min
avg_over_time(http_request_duration_seconds[5m])

# Max - szczytowa liczba połączeń
max_over_time(active_connections[1h])

# Sum - łączna liczba requestów
sum(increase(http_requests_total[1h]))

# Count - liczba pomiarów (do diagnostyki)
count_over_time(metric[5m])
```

### Standard options

**Unit**: Jednostka miary
```yaml
# Najczęściej używane jednostki w Stat:
# - percent (0-100): Procenty dla CPU, RAM, dysku
# - bytes: Bajty z automatyczną konwersją (B, KB, MB, GB)
# - short: Liczby bez jednostki (count)
# - ms: Milisekundy (czas odpowiedzi)
# - s: Sekundy (uptime, latency)
# - requests/sec: Żądania na sekundę
# - users: Użytkownicy (custom unit)
# - ops/sec: Operacje na sekundę
```

**Min/Max**: Sztywne minimum i maksimum (rzadko używane w Stat)

**Decimals**: Liczba miejsc po przecinku
- **Auto**: Grafana decyduje (domyślnie)
- **0**: Liczby całkowite (liczba użytkowników, zapytań)
- **1-2**: Standardowa precyzja (procenty, średnie)
- **3+**: Wysoka precyzja (dla bardzo małych wartości)

```yaml
# Przykłady:
# CPU %: 2 miejsca (75.42%)
# Liczba użytkowników: 0 miejsc (1,234)
# Czas odpowiedzi: 2 miejsca (123.45 ms)
# Konwersja: 3 miejsca (0.123%)
```

**Display name**: Nazwa wyświetlana zamiast oryginalnej nazwy serii
```
Przykład: ${__field.labels.instance} → "prod-server-01"
```

**Color scheme**: Schemat kolorów
- **Single color**: Jeden kolor (zielony zazwyczaj)
- **From thresholds**: Kolor zależny od progów (najczęściej używane)
- **Classic palette**: Różne kolory dla każdej serii
- **Green-Yellow-Red**: Gradient dla progów

**No value**: Tekst wyświetlany gdy brak danych
```
Domyślnie: "No data"
Własny: "N/A", "Offline", "—"
```

### Thresholds

Progi określające krytyczne poziomy i kolory:

**Mode**:
- **Absolute**: Stałe wartości progowe
- **Percentage**: Progi procentowe (0-100)

**Base**: Podstawowy kolor (dla wartości poniżej pierwszego progu)

**Steps**: Definicja progów
```yaml
# Przykład 1: CPU Usage (procenty)
# Base (0): Green
# 70: Yellow (uwaga)
# 85: Orange (ostrzeżenie)
# 95: Red (krytyczne)

# Przykład 2: Response Time (ms)
# Base (0): Green (szybko)
# 200: Yellow (akceptowalne)
# 500: Orange (wolno)
# 1000: Red (bardzo wolno)

# Przykład 3: Error Count
# Base (0): Green (brak błędów)
# 1: Yellow (pojedyncze błędy)
# 10: Orange (sporo błędów)
# 50: Red (krytycznie dużo)
```

**Show threshold markers**: Wyświetlanie markerów progów na wykresie trendu
- **On**: Pokaż linie progów na sparkline
- **Off**: Ukryj markery

**Show threshold labels**: Wyświetlanie etykiet progów
- **On**: Pokaż wartości progów
- **Off**: Ukryj etykiety

### Value mappings

Mapowanie wartości liczbowych na tekst lub zakresy na opisy:

**Value**: Mapowanie konkretnej wartości
```yaml
# Przykład - Status serwisu:
# 0 → "Offline" (red)
# 1 → "Online" (green)
# 2 → "Degraded" (yellow)

# Przykład - Boolean:
# 0 → "False"
# 1 → "True"
```

**Range**: Mapowanie zakresu wartości
```yaml
# Przykład - Klasyfikacja wykorzystania:
# 0-50 → "Low"
# 51-75 → "Medium"
# 76-90 → "High"
# 91-100 → "Critical"
```

**Regex**: Mapowanie na podstawie wyrażenia regularnego
```yaml
# Przykład - Status code:
# ^2.* → "Success"
# ^4.* → "Client Error"
# ^5.* → "Server Error"
```

**Special**: Mapowanie wartości specjalnych
- **Null**: Wartość null
- **NaN**: Not a Number
- **Empty**: Pusty string
- **True**: Boolean true
- **False**: Boolean false

### Data links

Linki do innych dashboardów lub zewnętrznych zasobów, aktywowane po kliknięciu w panel.

```yaml
# Przykład 1: Link do szczegółowego dashboardu serwera
# URL: /d/server-details?var-server=${__field.labels.instance}

# Przykład 2: Link do dokumentacji
# URL: https://docs.example.com/metrics/${__field.name}

# Przykład 3: Link do Grafana Loki logs
# URL: /explore?left={"datasource":"Loki","queries":[{"expr":"{instance=\"${__field.labels.instance}\"}"}]}
```

### Repeat options

Opcje automatycznego powielania panelu:

**Repeat by variable**: Tworzenie osobnego panelu Stat dla każdej wartości zmiennej
```yaml
# Przykład: Zmienna $server z wartościami: prod-01, prod-02, prod-03
# Wynik: 3 panele Stat, każdy dla innego serwera
```

**Repeat direction**: Kierunek powielania (horizontal/vertical)

**Max per row**: Maksymalna liczba paneli w jednym wierszu

## Przykłady zastosowania

### Przykład 1: Wykorzystanie CPU

```PromQL
# Zapytanie
100 - (avg(rate(node_cpu_seconds_total{mode="idle",instance="prod-01"}[5m])) * 100)
```

**Konfiguracja**:
- **Calculation**: Last (not null)
- **Unit**: `percent (0-100)`
- **Decimals**: 1
- **Graph mode**: Area
- **Color mode**: Background solid
- **Thresholds**: 0 (green), 70 (yellow), 85 (orange), 95 (red)

### Przykład 2: Liczba aktywnych użytkowników

```PromQL
# Zapytanie
sum(active_users)
```

**Konfiguracja**:
- **Calculation**: Last (not null)
- **Unit**: `short` (lub custom "users")
- **Decimals**: 0
- **Graph mode**: Line
- **Color mode**: Value
- **Thresholds**: 0 (gray), 1 (green)
- **Text mode**: Value and name

### Przykład 3: Średni czas odpowiedzi (p95)

```PromQL
# Zapytanie
histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le))
```

**Konfiguracja**:
- **Calculation**: Last (not null)
- **Unit**: `milliseconds (ms)`
- **Decimals**: 2
- **Graph mode**: Area
- **Color mode**: Background solid
- **Thresholds**: 0 (green), 200 (yellow), 500 (orange), 1000 (red)

### Przykład 4: Uptime (dni)

```PromQL
# Zapytanie
(time() - node_boot_time_seconds) / 86400
```

**Konfiguracja**:
- **Calculation**: Last (not null)
- **Unit**: `days`
- **Decimals**: 1
- **Graph mode**: None
- **Color mode**: Value
- **Thresholds**: 0 (red), 1 (yellow), 7 (green)
- **Display name**: "System Uptime"

### Przykład 5: Status serwisu (0/1)

```PromQL
# Zapytanie
up{job="api-service"}
```

**Konfiguracja**:
- **Calculation**: Last
- **Decimals**: 0
- **Graph mode**: None
- **Color mode**: Background solid
- **Value mappings**:
  - 0 → "OFFLINE"
  - 1 → "ONLINE"
- **Thresholds**: 0 (red), 1 (green)
- **Text size - Value**: Large

### Przykład 6: Liczba aktywnych alertów

```PromQL
# Zapytanie
count(ALERTS{alertstate="firing"})
```

**Konfiguracja**:
- **Calculation**: Last (not null)
- **Unit**: `short`
- **Decimals**: 0
- **Graph mode**: None
- **Color mode**: Background solid
- **Thresholds**: 0 (green), 1 (yellow), 5 (orange), 10 (red)
- **No value**: "0" (zamiast "No data")

## Najlepsze praktyki

### Dobór metryk do Stat

Stat najlepiej sprawdza się dla:
```yaml
✓ Pojedyncze wartości (nie szeregi czasowe)
✓ Kluczowe wskaźniki (KPI)
✓ Statusy i stany systemów
✓ Agregaty (średnie, sumy, max)
✓ Bieżące wykorzystanie zasobów
✓ Liczniki (count)
```

NIE używaj Stat dla:
```yaml
✗ Szczegółowych szeregów czasowych (użyj Time series)
✗ Porównań wielu kategorii (użyj Bar chart)
✗ Danych tabelarycznych (użyj Table)
✗ Złożonych trendów (użyj Time series)
```

### Układ paneli Stat na dashboardzie

**Row of Stat panels** - wiersz z kluczowymi metrykami na górze dashboardu:
```yaml
# Przykład dla monitoringu aplikacji:
[CPU %] [Memory %] [Active Users] [Response Time] [Error Rate]

# Szerokość: każdy panel 20% szerokości (1/5)
# Wysokość: 100-150px
# Color mode: Background solid
# Graph mode: None lub Line
```

**Grupowanie według tematyki**:
```yaml
# Resources Row:
[CPU] [Memory] [Disk I/O] [Network]

# Application Row:
[Active Sessions] [Requests/s] [Errors/min] [Response Time]

# Database Row:
[Connections] [Query Time] [Locks] [Cache Hit Rate]
```

### Kolorowanie

**Background solid** - dla statusów i alertów:
```yaml
# Użyj gdy:
- Kolor ma sygnalizować stan (OK/Warning/Critical)
- Panel jest mały (zmieści się w row)
- Użytkownik musi szybko ocenić status
```

**Value** - dla standardowych metryk:
```yaml
# Użyj gdy:
- Trend jest ważniejszy niż stan (graph mode: Area/Line)
- Wartość liczbowa jest kluczowa
- Chcesz zachować czytelność dashboardu
```

**None** - dla metryk bez progów:
```yaml
# Użyj gdy:
- Wyświetlasz liczniki bez kontekstu dobry/zły
- Panel jest dekoracyjny
- Kolorowanie nie ma sensu biznesowego
```

### Progi (Thresholds)

Zasada **4 progów** dla metryk wydajnościowych:
```yaml
# Schemat: OK → Uwaga → Ostrzeżenie → Krytyczne
Base (0): Green - wszystko OK
Threshold 1 (~70%): Yellow - zwróć uwagę
Threshold 2 (~85%): Orange - podejmij akcję
Threshold 3 (~95%): Red - natychmiastowa reakcja
```

Progi dla **liczby błędów**:
```yaml
0: Green - brak błędów
1: Yellow - pojedyncze błędy (do sprawdzenia)
10: Orange - wzrost błędów (problem)
50+: Red - krytyczna liczba błędów
```

Progi dla **statusu** (binary):
```yaml
0: Red - offline/error/false
1: Green - online/success/true
```

### Jednostki i precyzja

```yaml
# Procenty (CPU, RAM, dysk):
Unit: percent (0-100)
Decimals: 1-2

# Liczby całkowite (użytkownicy, połączenia):
Unit: short
Decimals: 0

# Czas odpowiedzi:
Unit: milliseconds (ms) lub seconds (s)
Decimals: 0-2

# Rozmiary danych:
Unit: bytes (automatyczna konwersja)
Decimals: 2

# Przepustowość:
Unit: bytes/sec lub bits/sec
Decimals: 2

# Count/Rate:
Unit: requests/sec, ops/sec, errors/min
Decimals: 0-1
```

### Graph mode w Stat

**None**: Dla prostych KPI bez kontekstu czasowego
```yaml
# Przykłady:
- Liczba serwerów online
- Status serwisu (0/1)
- Suma zamówień dzisiaj
```

**Line**: Dla subtelnego pokazania trendu
```yaml
# Przykłady:
- CPU % z lekkim trendem
- Liczba użytkowników z historią
- Response time ze sparkline
```

**Area**: Dla wyraźnej wizualizacji zmienności
```yaml
# Przykłady:
- Ruch sieciowy
- Liczba requestów
- Błędy w czasie
```

## Rozwiązywanie problemów

**Wyświetla "No data"**:
1. Sprawdź zakres czasowy (Time range) - czy dane są dostępne
2. Zweryfikuj zapytanie - uruchom w Explore
3. Sprawdź Calculation - "Last" może zwrócić null, użyj "Last (not null)"
4. Zmień "No value" na "0" jeśli zero ma sens

**Wartość nie aktualizuje się**:
1. Sprawdź Auto refresh dashboardu (góra strony)
2. Zweryfikuj czy źródło danych jest aktywne
3. Calculation może wskazywać na stary pomiar (First zamiast Last)

**Kolor tła nie zmienia się**:
1. Sprawdź Thresholds - czy są poprawnie ustawione
2. Color mode musi być "Background solid" lub "Background gradient"
3. Wartość może być poza zakresem progów - dostosuj progi

**Nieczytelna wartość**:
1. Zwiększ Text size → Value
2. Zmień Text mode na "Value" (bez name)
3. Zwiększ rozmiar panelu
4. Zmniejsz liczbę Decimals

**Sparkline nie wyświetla się**:
1. Graph mode musi być "Line" lub "Area"
2. Zapytanie musi zwracać szereg czasowy (nie pojedynczą wartość)
3. Zakres czasowy musi być wystarczająco długi (min. kilka punktów)

**Wartość jest błędna**:
1. Sprawdź Calculation - czy odpowiada zamiarowi
2. Dla rate() użyj wystarczająco długiego okna `[5m]`
3. Dla sum() upewnij się że agregrujesz poprawnie
4. Zmień Unit - może wpływać na wyświetlanie (bytes vs bits)